module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=372)}([function(e,t,n){"use strict";var r=o(n(31)),i=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var s=n(92),a=n(91);n(128);var u,c,l=n(9),f=l.getGlobal(),d=/\s+/;l.deduplicate=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e)&&t.push(e)}),t},l.capFirstLetter=function(e){return e?(e=""+e).slice(0,1).toUpperCase()+e.slice(1):""},l.guid=(u=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return u()+u()+u()+u()+u()+u()+u()+u()}),l.extend=function(e,t,n){for(var r in t)void 0!==e[r]&&!0!==n||(e[r]=t[r])},l.filterObj=function(e,t){var n={};return l.isString(t)&&(t=t.split(d)),t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n},l.copy=function(e,t){return t=t||{},e?(Object.keys(e).forEach(function(n){l.exist(e[n])&&(t[n]=e[n])}),t):t},l.copyWithNull=function(e,t){return t=t||{},e?(Object.keys(e).forEach(function(n){(l.exist(e[n])||l.isnull(e[n]))&&(t[n]=e[n])}),t):t},l.findObjIndexInArray=function(e,t){e=e||[];var n=t.keyPath||"id",r=-1;return e.some(function(e,i){if(a(e,n)===t.value)return r=i,!0}),r},l.findObjInArray=function(e,t){var n=l.findObjIndexInArray(e,t);return-1===n?null:e[n]},l.mergeObjArray=function(){var e=[],t=[].slice.call(arguments,0,-1),n=arguments[arguments.length-1];l.isArray(n)&&(t.push(n),n={});var r,i=n.keyPath=n.keyPath||"id";for(n.sortPath=n.sortPath||i;!e.length&&t.length;)e=(e=t.shift()||[]).slice(0);return t.forEach(function(t){t&&t.forEach(function(t){-1!==(r=l.findObjIndexInArray(e,{keyPath:i,value:a(t,i)}))?e[r]=l.merge({},e[r],t):e.push(t)})}),n.notSort||(e=l.sortObjArray(e,n)),e},l.cutObjArray=function(e){var t=e.slice(0),n=arguments.length,r=[].slice.call(arguments,1,n-1),i=arguments[n-1];l.isObject(i)||(r.push(i),i={});var o,s=i.keyPath=i.keyPath||"id";return r.forEach(function(e){l.isArray(e)||(e=[e]),e.forEach(function(e){e&&(i.value=a(e,s),-1!==(o=l.findObjIndexInArray(t,i))&&t.splice(o,1))})}),t},l.sortObjArray=function(e,t){var n=(t=t||{}).sortPath||"id";s.insensitive=!!t.insensitive;var r,i,o,u=!!t.desc;return o=l.isFunction(t.compare)?t.compare:function(e,t){return r=a(e,n),i=a(t,n),u?s(i,r):s(r,i)},e.sort(o)},l.emptyFunc=function(){},l.isEmptyFunc=function(e){return e===l.emptyFunc},l.notEmptyFunc=function(e){return e!==l.emptyFunc},l.splice=function(e,t,n){return[].splice.call(e,t,n)},l.reshape2d=function(e,t){if(Array.isArray(e)){l.verifyParamType("type",t,"number","util::reshape2d");var n=e.length;if(n<=t)return[e];for(var r=Math.ceil(n/t),i=[],o=0;o<r;o++)i.push(e.slice(o*t,(o+1)*t));return i}return e},l.flatten2d=function(e){if(Array.isArray(e)){var t=[];return e.forEach(function(e){t=t.concat(e)}),t}return e},l.dropArrayDuplicates=function(e){if(Array.isArray(e)){for(var t={},n=[];e.length>0;){t[e.shift()]=!0}for(var r in t)!0===t[r]&&n.push(r);return n}return e},l.onError=function(e){throw new function(e){"object"===(void 0===e?"undefined":(0,i.default)(e))?(this.callFunc=e.callFunc||null,this.message=e.message||"UNKNOW ERROR"):this.message=e,this.time=new Date,this.timetag=+this.time}(e)},l.verifyParamPresent=function(e,t,n,r){n=n||"";var i=!1;switch(l.typeOf(t)){case"undefined":case"null":i=!0;break;case"string":""===t&&(i=!0);break;case"StrStrMap":case"object":Object.keys(t).length||(i=!0);break;case"array":t.length?t.some(function(e){if(l.notexist(e))return i=!0,!0}):i=!0}i&&l.onParamAbsent(n+e,r)},l.onParamAbsent=function(e,t){l.onParamError("缺少参数 "+e+", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined",t)},l.verifyParamAbsent=function(e,t,n,r){n=n||"",void 0!==t&&l.onParamPresent(n+e,r)},l.onParamPresent=function(e,t){l.onParamError("多余的参数 "+e,t)},l.verifyParamType=function(e,t,n,r){var i=l.typeOf(t).toLowerCase();l.isArray(n)||(n=[n]);var o=!0;switch(-1===(n=n.map(function(e){return e.toLowerCase()})).indexOf(i)&&(o=!1),i){case"number":isNaN(t)&&(o=!1);break;case"string":"numeric or numeric string"===n.join("")&&(o=!!/^[0-9]+$/.test(t))}o||l.onParamInvalidType(e,n,"",r)},l.onParamInvalidType=function(e,t,n,r){n=n||"",t=l.isArray(t)?(t=t.map(function(e){return'"'+e+'"'})).join(", "):'"'+t+'"',l.onParamError('参数"'+n+e+'"类型错误, 合法的类型包括: ['+t+"]",r)},l.verifyParamValid=function(e,t,n,r){l.isArray(n)||(n=[n]),-1===n.indexOf(t)&&l.onParamInvalidValue(e,n,r)},l.onParamInvalidValue=function(e,t,n){l.isArray(t)||(t=[t]),t=t.map(function(e){return'"'+e+'"'}),l.isArray(t)&&(t=t.join(", ")),l.onParamError("参数 "+e+"值错误, 合法的值包括: ["+JSON.stringify(t)+"]",n)},l.verifyParamMin=function(e,t,n,r){t<n&&l.onParamError("参数"+e+"的值不能小于"+n,r)},l.verifyParamMax=function(e,t,n,r){t>n&&l.onParamError("参数"+e+"的值不能大于"+n,r)},l.verifyArrayMax=function(e,t,n,r){t.length>n&&l.onParamError("参数"+e+"的长度不能大于"+n,r)},l.verifyEmail=(c=/^\S+@\S+$/,function(e,t,n){c.test(t)||l.onParamError("参数"+e+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",n)}),l.verifyTel=function(){var e=/^[+\-()\d]+$/;return function(t,n,r){e.test(n)||l.onParamError("参数"+t+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",r)}}(),l.verifyBirth=function(){var e=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(t,n,r){e.test(n)||l.onParamError("参数"+t+'生日格式错误, 合法为"yyyy-MM-dd"',r)}}(),l.onParamError=function(e,t){l.onError({message:e,callFunc:t})},l.verifyOptions=function(e,t,n,r,i){if(e=e||{},t&&(l.isString(t)&&(t=t.split(d)),l.isArray(t))){"boolean"!=typeof n&&(i=n||null,n=!0,r="");var o=n?l.verifyParamPresent:l.verifyParamAbsent;t.forEach(function(t){o.call(l,t,e[t],r,i)})}return e},l.verifyParamAtLeastPresentOne=function(e,t,n){t&&(l.isString(t)&&(t=t.split(d)),l.isArray(t)&&(t.some(function(t){return l.exist(e[t])})||l.onParamError("以下参数["+t.join(", ")+"]至少需要传入一个",n)))},l.verifyParamPresentJustOne=function(e,t,n){t&&(l.isString(t)&&(t=t.split(d)),l.isArray(t)&&1!==t.reduce(function(t,n){return l.exist(e[n])&&t++,t},0)&&l.onParamError("以下参数["+t.join(", ")+"]必须且只能传入一个",n))},l.verifyBooleanWithDefault=function(e,t,n,r,i){l.undef(n)&&(n=!0),d.test(t)&&(t=t.split(d)),l.isArray(t)?t.forEach(function(t){l.verifyBooleanWithDefault(e,t,n,r,i)}):void 0===e[t]?e[t]=n:l.isBoolean(e[t])||l.onParamInvalidType(t,"boolean",r,i)},l.verifyFileInput=function(e,t){return l.verifyParamPresent("fileInput",e,"",t),l.isString(e)&&((e="undefined"==typeof document?void 0:document.getElementById(e))||l.onParamError("找不到要上传的文件对应的input, 请检查fileInput id "+e,t)),e.tagName&&"input"===e.tagName.toLowerCase()&&"file"===e.type.toLowerCase()||l.onParamError("请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:"+e.tagName+", filetype:"+e.type,t),e},l.verifyFileType=function(e,t){l.verifyParamValid("type",e,l.validFileTypes,t)},l.verifyCallback=function(e,t,n){d.test(t)&&(t=t.split(d)),l.isArray(t)?t.forEach(function(t){l.verifyCallback(e,t,n)}):e[t]?l.isFunction(e[t])||l.onParamInvalidType(t,"function","",n):e[t]=l.emptyFunc},l.verifyFileUploadCallback=function(e,t){l.verifyCallback(e,"uploadprogress uploaddone uploaderror uploadcancel",t)},l.validFileTypes=["image","audio","video","file"],l.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},l.filterFiles=function(e,t){var n,r,i="file"===(t=t.toLowerCase()),o=[];return[].forEach.call(e,function(e){if(i)o.push(e);else if(n=e.name.slice(e.name.lastIndexOf(".")+1),(r=e.type.split("/"))[0]&&r[1]){(r[0].toLowerCase()===t||-1!==l.validFileExts[t].indexOf(n))&&o.push(e)}}),o};var h,p,m=l.supportFormData=l.notundef(f.FormData);l.getFileName=function(e){return e=l.verifyFileInput(e),m?e.files[0].name:e.value.slice(e.value.lastIndexOf("\\")+1)},l.getFileInfo=(h={ppt:1,pptx:2,pdf:3,doc:6,docx:7},function(e){var t={};if(!(e=l.verifyFileInput(e)).files)return t;var n=e.files[0];return m&&(t.name=n.name,t.size=n.size,t.type=n.name.match(/\.(\w+)$/),t.type=t.type&&t.type[1].toLowerCase(),t.transcodeType=h[t.type]||0),t}),l.sizeText=(p=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(e){var t,n=0;do{t=(e=Math.floor(100*e)/100)+p[n],e/=1024,n++}while(e>1);return t}),l.promises2cmds=function(e){return e.map(function(e){return e.cmd})},l.objs2accounts=function(e){return e.map(function(e){return e.account})},l.teams2ids=function(e){return e.map(function(e){return e.teamId})},l.objs2ids=function(e){return e.map(function(e){return e.id})},l.getMaxUpdateTime=function(e){var t=e.map(function(e){return+e.updateTime});return Math.max.apply(Math,t)},l.genCheckUniqueFunc=function(e,t){return e=e||"id",t=t||1e3,function(t){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[e]=this.uniqueSet[e]||{};var n=this.uniqueSet[e],r=t[e];return!n[r]&&(n[r]=!0,!0)}},l.fillPropertyWithDefault=function(e,t,n){return!!l.undef(e[t])&&(e[t]=n,!0)},l.throttle=function(e,t,n){var r,i,o,s=null,a=0;n||(n={});var u=function(){a=!1===n.leading?0:(new Date).getTime(),s=null,o=e.apply(r,i),s||(r=i=null)};return function(){var c=(new Date).getTime();a||!1!==n.leading||(a=c);var l=t-(c-a);return r=this,i=arguments,l<=0||l>t?(clearTimeout(s),s=null,a=c,o=e.apply(r,i),s||(r=i=null)):s||!1===n.trailing||(s=setTimeout(u,l)),o}},l.get=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=t.replace(/\[(\d+)\]/g,".$1").split("."),i=e,o=!0,s=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(void 0===(i=Object(i)[l]))return n}}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}return i},l.pickAsString=function(e,t){return e?t.filter(function(t){return void 0!==e[t]}).map(function(t){return t+"="+e[t]}).join(","):""},l.omitAsString=function(e,t){if(!e)return"";var n={};return t.forEach(function(e){n[e]=!0}),Object.keys(e).filter(function(e){return!n[e]}).map(function(t){return t+"="+e[t]}).join(",")};var v={session:function(e){var t=(0,r.default)({},e);return["topCustom","localCustom","extra"].forEach(function(e){t[e]&&(t[e]="***")}),t.lastMsg&&(t.lastMsg={idServer:t.lastMsg.idServer,idClient:t.lastMsg.idClient}),t}};l.secureOutput=function(e,t){Array.isArray(t)||(t=[t]);var n=v[e];return 1===(t=t.map(function(e){return n(e)})).length?t[0]:t};var _={string:function(e,t,n){var r=n.required,i=n.allowEmpty,o=e[t];return!1===r&&void 0===o||"string"==typeof o&&!(!i&&""===o)},number:function(e,t,n){var r=n.required,i=n.min,o=e[t];return!1===r&&void 0===o||"number"==typeof o&&!(o<i)},enum:function(e,t,n){var r=n.required,i=n.values,o=e[t];return!1===r&&void 0===o||i.indexOf(o)>-1},array:function(e,t,n){var r=n.required,i=e[t];return!1===r&&void 0===i||!!Array.isArray(i)}};l.validate=function(e,t,n){var r={};return Object.keys(e).forEach(function(i){var o=e[i].type,s=_[o];s&&!s(t,i,e[i])?l.onError({message:"Error in parameter verification, "+i+" expected value is "+JSON.stringify(e[i]),callFunc:n}):r[i]=t[i]}),r},e.exports=l},function(e,t,n){"use strict";n(0);var r=!1;try{"function"==typeof localStorage.setItem&&"function"==typeof localStorage.getItem&&(localStorage.setItem("nim_localstorage_exist_test","1"),r="1"===localStorage.getItem("nim_localstorage_exist_test"),localStorage.removeItem("nim_localstorage_exist_test"))}catch(e){r=!1}var i={nodeEnv:"production",info:{hash:"28f639e7da86fc50a3222fd63d3a43e3001f58e7",shortHash:"28f639e7d",version:"8.7.0",sdkVersion:"210",sdkHumanVersion:"8.7.0",nrtcVersion:"5.1.0",nrtcSdkVersion:"1",protocolVersion:1},agentVersion:"3.0.1",lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",roomserver:"roomserver.netease.im",connectTimeout:8e3,xhrTimeout:8e3,socketTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:3e4,cmdTimeout:8e3,hbCmdTimeout:5e3,defaultReportUrl:"https://dr.netease.im/1.gif",isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,netDetectAddr:"https://roomserver-dev.netease.im/v1/sdk/detect/local",optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:r?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:r,getDefaultLinkUrl:function(e){var t,n;1===i.ipVersion?(t=i.optionIpv6DefaultLinkUrl,n=i.ipv6DefaultLinkUrl):(t=i.optionDefaultLinkUrl,n=i.defaultLinkUrl);var r=t||(i.isWeixinApp?i.wxDefaultLinkUrl:n);if(!r)return!1;var o=e?"https":"http",s=e?"443":"80",a=r;return-1===r.indexOf("http")&&(a=o+"://"+a),-1===r.indexOf(":")&&(a=a+":"+s),a}};i.weixinNetcall=i.nrtcNetcall={checkSumUrl:"https://nrtc.netease.im/demo/getChecksum.action",getChannelInfoUrl:"https://nrtc.netease.im/nrtc/getChannelInfos.action"},i.ipProbeAddr={ipv4:"https://detect4.netease.im/test/",ipv6:"https://detect6.netease.im/test/"},i.nrtcWebRTC2={checkSumUrl:"",getChannelInfoUrl:""},i.formatSocketUrl=function(e){var t=e.url,n=e.secure?"https":"http";return-1===t.indexOf("http")?n+"://"+t:t},i.uploadUrl="https://nos.netease.com",i.chunkUploadUrl="https://wanproxy-web.127.net",i.commonMaxSize=104857600,i.chunkSize=4194304,i.chunkMaxSize=4194304e4,i.replaceUrl="https://{bucket}-nosdn.netease.im/{object}",i.downloadHost="nos.netease.com",i.downloadHostList=["nos.netease.com"],i.nosCdnEnable=!0,i.downloadUrl="https://{bucket}-nosdn.netease.im/{object}",i.httpsEnabled=!1,i.threshold=0,i.nosLbsUrls=["http://wanproxy.127.net/lbs","http://wanproxy-bj.127.net/lbs","http://wanproxy-hz.127.net/lbs","http://wanproxy-oversea.127.net/lbs"],i.genUploadUrl=function(e){return i.uploadUrl+"/"+e},i.genChunkUploadUrl=function(e){return i.chunkUploadUrl?i.chunkUploadUrl+"/"+e.bucket+"/"+e.objectName:""},i.genDownloadUrl=function(e,t,n){var r=e.bucket,o=(e.tag,e.expireSec),s=+new Date,a=o?"&survivalTime="+o:"";if(n)return"https://"+n+"/"+t+"?createTime="+s+a;var u=i.replaceUrl+"?createTime="+s+a;return(u=i.genNosProtocolUrl(u)).replace("{bucket}",r).replace("{object}",t)},i.genFileUrl=function(e){var t=e.bucket,n=e.objectName;return i.genNosProtocolUrl(i.replaceUrl).replace("{bucket}",t).replace("{object}",n)},i.genNosProtocolUrl=function(e){return/^http/.test(e)?i.httpsEnabled&&0!==e.indexOf("https://")&&(e=e.replace("http","https")):e=i.httpsEnabled?"https://"+e:"http://"+e,e},e.exports=i},function(e,t,n){"use strict";t.__esModule=!0;var r=s(n(163)),i=s(n(153)),o="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function s(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===o(r.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=n)},,function(e,t,n){var r=n(54)("wks"),i=n(36),o=n(3).Symbol,s="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=r},,function(e,t,n){"use strict";var r,i=n(2),o=(r=i)&&r.__esModule?r:{default:r};function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.message=e||n.message||"","object"===(void 0===t?"undefined":(0,o.default)(t))?(this.event=t,this.code="Other_Error"):void 0!==t&&(this.code=t),this.timetag=+new Date,void 0!==n&&(this.event=n),this.event&&(this.callFunc=this.event.callFunc||null,delete this.event.callFunc)}s.prototype=Object.create(Error.prototype),s.prototype.name="NIMError";var a={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",700:"批量操作部分失败",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",816:"批量操作部分失败",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消"};[200,406,808,810].forEach(function(e){a[e]=null}),s.genError=function(e){var t=a[e];return void 0===t&&(t="操作失败"),null===t?null:new s(t,e)},s.multiInstance=function(e){return new s("不允许初始化多个实例","Not_Allow_Multi_Instance",e)},s.newNetworkError=function(e){var t="Error_Internet_Disconnected";return new s(a[t],t,e)},s.newConnectError=function(e){var t="Connect_Failed";return new s(a[t]||null,t,e)},s.newConnectionError=function(e){var t="Error_Connection_is_not_Established";return new s(a[t],t,e)},s.newSocketStateError=function(e){var t="Error_Connection_Socket_State_not_Match";return new s(a[t],t,e)},s.newTimeoutError=function(e){var t="Error_Timeout";return new s(a[t],t,e)},s.newFrequencyControlError=function(e){var t=new s(a[416],416,e);return t.from="local",t},s.newParamError=function(e,t){return new s(e||a.Param_Error,"Param_Error",t)},s.newNoFileError=function(e,t){var n="No_File_Selected";return new s(e||a[n],n,t)},s.newWrongFileTypeError=function(e,t){var n="Wrong_File_Type";return new s(e||a[n],n,t)},s.newFileTooLargeError=function(e,t){var n="File_Too_Large";return new s(e||a[n],n,t)},s.newCORSIframeError=function(e){var t="Cross_Origin_Iframe";return new s(a[t],t,e)},s.newSupportError=function(e,t,n){return new s("不支持"+e,"Not_Support_"+t,n)},s.newSupportDBError=function(e){return s.newSupportError("数据库","DB",e)},s.noDBError=function(e){return new s(a.NO_DB,"NO_DB",e)},s.newDBError=function(e){return new s(a.DB,"DB",e)},s.newUnknownError=function(e){var t="Error_Unknown";return new s(a[t],t,e)},s.stillInTeamError=function(e){var t="Still_In_Team";return new s(a[t],t,e)},s.sessionExist=function(e){var t="Session_Exist";return new s(a[t],t,e)},s.sessionNotExist=function(e){var t="Session_Not_Exist";return new s(a[t],t,e)},s.cancel=function(e){var t="Operation_Canceled";return new s(a[t],t,e)},s.customError=function(e,t){e=e||"Other_Error";var n="";return(t=t||{}).message||(n=a[e]||e),"object"!==(void 0===e?"undefined":(0,o.default)(e))?new s(n,e,t):new s(n,"Other_Error",void 0===t?e:t)},e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.url2origin=t.uniqueID=t.off=t.removeEventListener=t.on=t.addEventListener=t.format=t.regWhiteSpace=t.regBlank=t.emptyFunc=t.f=t.emptyObj=t.o=void 0;var r,i=n(2),o=(r=i)&&r.__esModule?r:{default:r};t.getGlobal=s,t.detectCSSFeature=function(e){var t=!1,n="Webkit Moz ms O".split(" ");if("undefined"==typeof document)return void console.log("error:fn:detectCSSFeature document is undefined");var r=document.createElement("div"),i=null;e=e.toLowerCase(),void 0!==r.style[e]&&(t=!0);if(!1===t){i=e.charAt(0).toUpperCase()+e.substr(1);for(var o=0;o<n.length;o++)if(void 0!==r.style[n[o]+i]){t=!0;break}}return t},t.fix=a,t.getYearStr=u,t.getMonthStr=c,t.getDayStr=l,t.getHourStr=f,t.getMinuteStr=d,t.getSecondStr=h,t.getMillisecondStr=p,t.dateFromDateTimeLocal=function(e){return e=""+e,new Date(e.replace(/-/g,"/").replace("T"," "))},t.getClass=_,t.typeOf=g,t.isString=y,t.isNumber=b,t.isInt=function(e){return b(e)&&e%1==0},t.isBoolean=function(e){return"boolean"===g(e)},t.isArray=w,t.isFunction=S,t.isDate=C,t.isRegExp=function(e){return"regexp"===g(e)},t.isError=function(e){return"error"===g(e)},t.isnull=k,t.notnull=E,t.undef=O,t.notundef=x,t.exist=T,t.notexist=I,t.isObject=N,t.isEmpty=function(e){return I(e)||(y(e)||w(e))&&0===e.length},t.containsNode=function(e,t){if(e===t)return!0;for(;t.parentNode;){if(t.parentNode===e)return!0;t=t.parentNode}return!1},t.calcHeight=function(e){var t=e.parentNode||("undefined"==typeof document?null:document.body);if(!t)return 0;(e=e.cloneNode(!0)).style.display="block",e.style.opacity=0,e.style.height="auto",t.appendChild(e);var n=e.offsetHeight;return t.removeChild(e),n},t.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},t.dataset=function(e,t,n){if(!T(n))return e.getAttribute("data-"+t);e.setAttribute("data-"+t,n)},t.target=function(e){return e.target||e.srcElement},t.createIframe=function(e){if("undefined"==typeof document)return;var t;if((e=e||{}).name)try{(t=document.createElement('<iframe name="'+e.name+'"></iframe>')).frameBorder=0}catch(n){(t=document.createElement("iframe")).name=e.name}else t=document.createElement("iframe");e.visible||(t.style.display="none");S(e.onload)&&A(t,"load",function n(r){if(!t.src)return;e.multi||M(t,"load",n);e.onload(r)});(e.parent||document.body).appendChild(t);var n=e.src||"about:blank";return setTimeout(function(){t.src=n},0),t},t.html2node=function(e){if("undefined"==typeof document)return;var t=document.createElement("div");t.innerHTML=e;var n=[],r=void 0,i=void 0;if(t.children)for(r=0,i=t.children.length;r<i;r++)n.push(t.children[r]);else for(r=0,i=t.childNodes.length;r<i;r++){var o=t.childNodes[r];1===o.nodeType&&n.push(o)}return n.length>1?t:n[0]},t.scrollTop=function(e){"undefined"!=typeof document&&T(e)&&(document.documentElement.scrollTop=document.body.scrollTop=e);return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},t.forOwn=j,t.mixin=U,t.isJSON=R,t.parseJSON=function e(t){try{R(t)&&(t=JSON.parse(t)),N(t)&&j(t,function(n,r){switch(g(r)){case"string":case"object":t[n]=e(r)}})}catch(e){console.log("error:",e)}return t},t.simpleClone=function(e){var t=[],n=JSON.stringify(e,function(e,n){if("object"===(void 0===n?"undefined":(0,o.default)(n))&&null!==n){if(-1!==t.indexOf(n))return;t.push(n)}return n});return JSON.parse(n)},t.merge=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.forEach(function(t){U(e,t)}),e},t.fillUndef=function(e,t){return j(t,function(t,n){O(e[t])&&(e[t]=n)}),e},t.checkWithDefault=function(e,t,n){var r=e[t]||e[t.toLowerCase()];I(r)&&(r=n,e[t]=r);return r},t.fetch=function(e,t){return j(e,function(n,r){T(t[n])&&(e[n]=t[n])}),e},t.string2object=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n={};return e.split(t).forEach(function(e){var t=e.split("="),r=t.shift();r&&(n[decodeURIComponent(r)]=decodeURIComponent(t.join("=")))}),n},t.object2string=W,t.genUrlSep=function(e){return e.indexOf("?")<0?"?":"&"},t.object2query=function(e){return W(e,"&",!0)},t.isFileInput=D,t.getKeys=function(e,t){var n=Object.keys(e);t&&n.sort(function(t,n){var r=D(e[t]),i=D(e[n]);return r===i?0:r?1:-1});return n},t._get=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=t.replace(/\[(\d+)\]/g,".$1").split("."),i=e,o=!0,s=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(void 0===(i=Object(i)[l]))return n}}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}return i};t.o={},t.emptyObj={},t.f=function(){},t.emptyFunc=function(){},t.regBlank=/\s+/gi,t.regWhiteSpace=/\s+/gi;function s(){return"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}}function a(e,t){t=t||2;for(var n=""+e;n.length<t;)n="0"+n;return n}function u(e){return""+e.getFullYear()}function c(e){return a(e.getMonth()+1)}function l(e){return a(e.getDate())}function f(e){return a(e.getHours())}function d(e){return a(e.getMinutes())}function h(e){return a(e.getSeconds())}function p(e){return a(e.getMilliseconds(),3)}var m,v;t.format=(m=/yyyy|MM|dd|hh|mm|ss|SSS/g,v={yyyy:u,MM:c,dd:l,hh:f,mm:d,ss:h,SSS:p},function(e,t){return e=new Date(e),isNaN(+e)?"invalid date":(t=t||"yyyy-MM-dd").replace(m,function(t){return v[t](e)})});function _(e){return Object.prototype.toString.call(e).slice(8,-1)}function g(e){return _(e).toLowerCase()}function y(e){return"string"===g(e)}function b(e){return"number"===g(e)}function w(e){return"array"===g(e)}function S(e){return"function"===g(e)}function C(e){return"date"===g(e)}function k(e){return null===e}function E(e){return null!==e}function O(e){return void 0===e}function x(e){return void 0!==e}function T(e){return x(e)&&E(e)}function I(e){return O(e)||k(e)}function N(e){return T(e)&&"object"===g(e)}var P=t.addEventListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},A=t.on=P,L=t.removeEventListener=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},M=t.off=L;function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments[2];for(var r in e)e.hasOwnProperty(r)&&t.call(n,r,e[r])}function U(e,t){j(t,function(t,n){e[t]=n})}var B;t.uniqueID=(B=0,function(){return""+B++});function R(e){return y(e)&&0===e.indexOf("{")&&e.lastIndexOf("}")===e.length-1}function W(e,t,n){if(!e)return"";var r=[];return j(e,function(e,t){S(t)||(C(t)?t=t.getTime():w(t)?t=t.join(","):N(t)&&(t=JSON.stringify(t)),n&&(t=encodeURIComponent(t)),r.push(encodeURIComponent(e)+"="+t))}),r.join(t||",")}t.url2origin=function(){var e=/^([\w]+?:\/\/.*?(?=\/|$))/i;return function(t){return e.test(t||"")?RegExp.$1.toLowerCase():""}}();function D(e){var t=s();return e.tagName&&"INPUT"===e.tagName.toUpperCase()||t.Blob&&e instanceof t.Blob}},function(e,t,n){var r=n(13),i=n(85),o=n(56),s=Object.defineProperty;t.f=n(11)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){e.exports=!n(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(19);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(3),i=n(4),o=n(46),s=n(15),a=n(12),u=function(e,t,n){var c,l,f,d=e&u.F,h=e&u.G,p=e&u.S,m=e&u.P,v=e&u.B,_=e&u.W,g=h?i:i[t]||(i[t]={}),y=g.prototype,b=h?r:p?r[t]:(r[t]||{}).prototype;for(c in h&&(n=t),n)(l=!d&&b&&void 0!==b[c])&&a(g,c)||(f=l?b[c]:n[c],g[c]=h&&"function"!=typeof b[c]?n[c]:v&&l?o(f,r):_&&b[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):m&&"function"==typeof f?o(Function.call,f):f,m&&((g.virtual||(g.virtual={}))[c]=f,e&u.R&&y&&!y[c]&&s(y,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){var r=n(10),i=n(28);e.exports=n(11)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},,function(e,t,n){"use strict";var r=n(30),i=n(123),o=n(122),s=n(121);r.json=i,r.upload=o,r.chunkUpload=s,e.exports=r},function(e,t,n){var r=n(82),i=n(57);e.exports=function(e){return r(i(e))}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},,,function(e,t,n){"use strict";var r=n(87),i=n(88);e.exports={description:"nodejs app",layout:null,manufacturer:null,name:i.hostname(),prerelease:null,product:null,ua:"Node.js "+r.version,version:r.version,os:{architecture:i.arch(),family:""+i.release,version:""}}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},,,function(e,t){e.exports={}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},,function(e,t,n){"use strict";var r=n(9),i=n(127),o=n(125),s=n(124),a={},u=r.f;function c(e){var t=e.upload="multipart/form-data"===(e.headers||r.o)["Content-Type"],n=!1;try{n=(location.protocol+"//"+location.host).toLowerCase()!==r.url2origin(e.url)}catch(e){}return e.cors=n,t||n||e.mode?function(e){var t=e.mode,n=i,a=r.getGlobal();return!a.FormData&&a.document&&(t="iframe"),"iframe"===t&&(n=e.upload?o:s),new n(e)}(e):new i(e)}function l(e,t,n){var r=a[e];if(r){"onload"===t&&r.result&&(n=function(e,t){t={data:t};var n=e.result.headers;return n&&(t.headers=e.req.header(n)),t}(r,n)),function(e){var t=a[e];t&&(t.req.destroy(),delete a[e])}(e);var i={type:t,result:n};u(i),i.stopped||r[t](i.result)}}function f(e,t){var n=r.genUrlSep(e);return t=t||"",r.isObject(t)&&(t=r.object2query(t)),t&&(e+=n+t),e}function d(e,t){t=t||{};var n=r.uniqueID(),i={result:t.result,onload:t.onload||r.f,onerror:t.onerror||r.f};a[n]=i,t.onload=function(e,t){l(e,"onload",t)}.bind(null,n),t.onerror=function(e,t){l(e,"onerror",t)}.bind(null,n),t.query&&(e=f(e,t.query));var o=t.method||"";return o&&!/get/i.test(o)||!t.data||(e=f(e,t.data),t.data=null),t.url=e,i.req=c(t),n}d.filter=function(e){r.isFunction(e)&&(u=e)},d.abort=function(e){var t=a[e];t&&t.req&&t.req.abort()},e.exports=d},function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(132),o=(r=i)&&r.__esModule?r:{default:r};t.default=o.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){"use strict";const r=n(137),i=n(136),o=n(48),s=n(24),a=Buffer.from([0,0,255,255]),u=Buffer.from([0]),c=Symbol("permessage-deflate"),l=Symbol("write-in-progress"),f=Symbol("pending-close"),d=Symbol("total-length"),h=Symbol("callback"),p=Symbol("buffers"),m=Symbol("error");let v;function _(e){this[p].push(e),this[d]+=e.length}function g(e){this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload?this[p].push(e):(this[m]=new RangeError("Max payload size exceeded"),this[m][s.kStatusCode]=1009,this.removeListener("data",g),this.reset())}function y(e){this[c]._inflate=null,e[s.kStatusCode]=1007,this[h](e)}e.exports=class{constructor(e,t,n){if(this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!v){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;v=new r({concurrency:e})}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate[l]?this._inflate[f]=!0:(this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate[l]?this._deflate[f]=!0:(this._deflate.close(),this._deflate=null))}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{var n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){v.push(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){v.push(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:t})),this._inflate[c]=this,this._inflate[d]=0,this._inflate[p]=[],this._inflate.on("error",y),this._inflate.on("data",g)}this._inflate[h]=n,this._inflate[l]=!0,this._inflate.write(e),t&&this._inflate.write(a),this._inflate.flush(()=>{const e=this._inflate[m];if(e)return this._inflate.close(),this._inflate=null,void n(e);const i=o.concat(this._inflate[p],this._inflate[d]);t&&this.params[`${r}_no_context_takeover`]||this._inflate[f]?(this._inflate.close(),this._inflate=null):(this._inflate[l]=!1,this._inflate[d]=0,this._inflate[p]=[]),n(null,i)})}_compress(e,t,n){if(!e||0===e.length)return void process.nextTick(n,null,u);const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw(Object.assign({memLevel:this._options.memLevel,level:this._options.level},this._options.zlibDeflateOptions,{windowBits:t})),this._deflate[d]=0,this._deflate[p]=[],this._deflate.on("data",_)}this._deflate[l]=!0,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{var e=o.concat(this._deflate[p],this._deflate[d]);t&&(e=e.slice(0,e.length-4)),t&&this.params[`${r}_no_context_takeover`]||this._deflate[f]?(this._deflate.close(),this._deflate=null):(this._deflate[l]=!1,this._deflate[d]=0,this._deflate[p]=[]),n(null,e)})}}},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("http")},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){var r=n(83),i=n(53);e.exports=Object.keys||function(e){return r(e,i)}},,function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(144),o=(r=i)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},,function(e,t){e.exports=require("crypto")},function(e,t,n){var r=n(10).f,i=n(12),o=n(6)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=!0},function(e,t,n){var r=n(66);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";var r=n(9),i=r.f,o=n(126);function s(e){e.onload&&this.once("load",e.onload),e.onerror&&this.once("error",e.onerror),e.onbeforesend&&this.once("beforesend",e.onbeforesend),e.onaftersend&&this.once("aftersend",e.onaftersend);var t=(e=this.options=r.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},e)).headers;r.notexist(t["Content-Type"])&&(t["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var a=s.prototype=Object.create(o.prototype);a.send=function(){var e=this,t=e.options;setTimeout(function(){try{try{e.emit("beforesend",t)}catch(e){console.log("error:","ignore error ajax beforesend,",e)}e.doSend()}catch(t){console.log("error:","ignore error server error,",t),e.onError("serverError","请求失败:"+t.message)}},0)},a.doSend=i,a.afterSend=function(){var e=this;setTimeout(function(){e.emit("aftersend",e.options)},0)},a.onLoad=function(e){var t=this.options,n=e.status,r=e.result;if("number"!=typeof n||0!==n)if(0===(""+n).indexOf("2")){if("json"===t.type)try{r=JSON.parse(r)}catch(e){return console.log("error:","ignore error parse json,",e),void this.onError("parseError",r)}this.emit("load",r)}else this.onError("serverError","服务器返回异常状态",{status:n,result:r,date:e.date});else this.onError("netError","网络错误")},a.onError=function(e,t,n){var i=r.isObject(n)?n:{};i.code=e||"error",i.message=t||"发生错误",this.emit("error",i)},a.onTimeout=function(){this.onError("timeout","请求超时")},a.abort=function(){this.onError("abort","客户端中止")},a.header=function(e){var t=this;if(!r.isArray(e))return t.getResponseHeader(e||"");var n={};return e.forEach(function(e){n[e]=t.header(e)}),n},a.getResponseHeader=i,a.destroy=i,e.exports=s},function(e,t,n){"use strict";function r(e,t){const n=Buffer.allocUnsafe(t);for(var r=0,i=0;i<e.length;i++){const t=e[i];t.copy(n,r),r+=t.length}return n}function i(e,t,n,r,i){for(var o=0;o<i;o++)n[r+o]=e[o]^t[3&o]}function o(e,t){const n=e.length;for(var r=0;r<n;r++)e[r]^=t[3&r]}try{const t=n(!function(){var e=new Error('Cannot find module "bufferutil"');throw e.code="MODULE_NOT_FOUND",e}()),s=t.BufferUtil||t;e.exports={mask(e,t,n,r,o){o<48?i(e,t,n,r,o):s.mask(e,t,n,r,o)},unmask(e,t){e.length<32?o(e,t):s.unmask(e,t)},concat:r}}catch(t){e.exports={concat:r,mask:i,unmask:o}}},function(e,t){e.exports=require("https")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(3),i=n(4),o=n(45),s=n(52),a=n(10).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},function(e,t,n){t.f=n(6)},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(3),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,n){var r=n(54)("keys"),i=n(36);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(19);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(161)(!0);n(86)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},,function(e,t,n){var r=n(57);e.exports=function(e){return Object(r(e))}},,,function(e,t,n){n(156);for(var r=n(3),i=n(15),o=n(27),s=n(6)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var c=a[u],l=r[c],f=l&&l.prototype;f&&!f[s]&&i(f,s,c),o[c]=o.Array}},function(e,t,n){var r=n(19),i=n(3).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(13),i=n(159),o=n(53),s=n(55)("IE_PROTO"),a=function(){},u=function(){var e,t=n(65)("iframe"),r=o.length;for(t.style.display="none",n(100).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[o[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=u(),void 0===t?n:i(n,t)}},,,,,,function(e,t,n){"use strict";var r=n(9),i=r.getGlobal(),o={},s=i.name||"_parent",a=[],u=[];o.addMsgListener=function(e){a.push(e)};var c,l,f,d,h=(c=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(e){return e=e||"",c.test(e)?RegExp.$1:"*"}),p=function(){var e=unescape(i.name||"").trim();if(e&&0===e.indexOf("MSG|")){i.name="";var t=r.string2object(e.replace("MSG|",""),"|"),n=(t.origin||"").toLowerCase();n&&"*"!==n&&0!==location.href.toLowerCase().indexOf(n)||function(e){for(var t=0,n=a.length;t<n;t++)try{a[t].call(null,e)}catch(e){}}({data:JSON.parse(t.data||"null"),source:i.frames[t.self]||t.self,origin:h(t.ref||("undefined"==typeof document?"":document.referrer))})}},m=(f=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1},function(){if(u.length){l=[];for(var e,t=u.length-1;t>=0;t--)e=u[t],f(l,e.w)||(l.push(e.w),u.splice(t,1),e.w.name=e.d);l=null}}),v=o.startTimer=(d=!1,function(){d||(d=!0,i.postMessage||(setInterval(m,100),setInterval(p,20)))});o.postMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.fillUndef(t,{origin:"*",source:s}),i.postMessage){var n=t.data;i.FormData||(n=JSON.stringify(n)),e.postMessage(n,t.origin)}else{if(v(),r.isObject(t)){var o={};o.origin=t.origin||"",o.ref=location.href,o.self=t.source,o.data=JSON.stringify(t.data),t="MSG|"+r.object2string(o,"|",!0)}u.unshift({w:e,d:escape(t)})}},e.exports=o},function(e,t,n){"use strict";const r=n(42),i=n(32),o=n(48),s=n(75),a=n(24);class u{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const n=e.length<1024||t.mask&&t.readOnly;var i=t.mask?6:2,s=e.length;e.length>=65536?(i+=8,s=127):e.length>125&&(i+=2,s=126);const a=Buffer.allocUnsafe(n?e.length+i:i);if(a[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(a[0]|=64),126===s?a.writeUInt16BE(e.length,2):127===s&&(a.writeUInt32BE(0,2),a.writeUInt32BE(e.length,6)),!t.mask)return a[1]=s,n?(e.copy(a,i),[a]):[a,e];const u=r.randomBytes(4);return a[1]=128|s,a[i-4]=u[0],a[i-3]=u[1],a[i-2]=u[2],a[i-1]=u[3],n?(o.mask(e,u,a,i,e.length),[a]):(o.mask(e,u,e,0,e.length),[a,e])}close(e,t,n,r){var i;if(void 0===e)i=a.EMPTY_BUFFER;else{if("number"!=typeof e||!s.isValidStatusCode(e))throw new TypeError("First argument must be a valid error code number");void 0===t||""===t?(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0):((i=Buffer.allocUnsafe(2+Buffer.byteLength(t))).writeUInt16BE(e,0),i.write(t,2))}this._deflating?this.enqueue([this.doClose,i,n,r]):this.doClose(i,n,r)}doClose(e,t,n){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=c(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPing,e,t,r,n]):this.doPing(e,t,r,n)}doPing(e,t,n,r){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),r)}pong(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=c(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPong,e,t,r,n]):this.doPong(e,t,r,n)}doPong(e,t,n,r){this.sendFrame(u.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),r)}send(e,t,n){var r=t.binary?2:1,o=t.compress,s=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=c(e):(e=Buffer.from(e),s=!1));const a=this._extensions[i.extensionName];if(this._firstFragment?(this._firstFragment=!1,o&&a&&(o=e.length>=a._threshold),this._compress=o):(o=!1,r=0),t.fin&&(this._firstFragment=!0),a){const i={fin:t.fin,rsv1:o,opcode:r,mask:t.mask,readOnly:s};this._deflating?this.enqueue([this.dispatch,e,this._compress,i,n]):this.dispatch(e,this._compress,i,n)}else this.sendFrame(u.frame(e,{fin:t.fin,rsv1:!1,opcode:r,mask:t.mask,readOnly:s}),n)}dispatch(e,t,n,r){if(!t)return void this.sendFrame(u.frame(e,n),r);const o=this._extensions[i.extensionName];this._deflating=!0,o.compress(e,n.fin,(e,t)=>{n.readOnly=!1,this.sendFrame(u.frame(t,n),r),this._deflating=!1,this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.write(e[0]),this._socket.write(e[1],t)):this._socket.write(e[0],t)}}function c(e){const t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength?t.slice(e.byteOffset,e.byteOffset+e.byteLength):t}e.exports=u},function(e,t,n){"use strict";try{const e=n(!function(){var e=new Error('Cannot find module "utf-8-validate"');throw e.code="MODULE_NOT_FOUND",e}());t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=(()=>!0)}t.isValidStatusCode=(e=>e>=1e3&&e<=1013&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999)},function(e,t,n){"use strict";const r=n(134),i=n(32),o=n(48),s=n(75),a=n(24),u=0,c=1,l=2,f=3,d=4,h=5;function p(e,t,n,r){const i=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,p),i[a.kStatusCode]=r,i}function m(e,t){return 1===e.length?e[0]:e.length>1?o.concat(e,t):a.EMPTY_BUFFER}e.exports=class extends r.Writable{constructor(e,t,n){super(),this._binaryType=e||a.BINARY_TYPES[0],this[a.kWebSocket]=void 0,this._extensions=t||{},this._maxPayload=0|n,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=u,this._loop=!1}_write(e,t,n){if(8===this._opcode)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do{switch(this._state){case u:t=this.getInfo();break;case c:t=this.getPayloadLength16();break;case l:t=this.getPayloadLength64();break;case f:this.getMask();break;case d:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,p(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[i.extensionName])return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,p(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,p(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,p(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,p(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,p(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),126===this._payloadLength)this._state=c;else{if(127!==this._payloadLength)return this.haveLength();this._state=l}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,p(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,p(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=f:this._state=d}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=d)}getData(e){var t=a.EMPTY_BUFFER;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&o.unmask(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=h,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(p(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)})}dataMessage(){if(this._fin){const n=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var e;e="nodebuffer"===this._binaryType?m(r,n):"arraybuffer"===this._binaryType?0===(t=m(r,n)).byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):r,this.emit("message",e)}else{const e=m(r,n);if(!s.isValidUTF8(e))return this._loop=!1,p(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",e.toString())}}var t;this._state=u}controlMessage(e){if(8!==this._opcode)9===this._opcode?this.emit("ping",e):this.emit("pong",e),this._state=u;else if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return p(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!s.isValidStatusCode(t))return p(RangeError,`invalid status code ${t}`,!0,1002);const n=e.slice(2);if(!s.isValidUTF8(n))return p(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}}}},function(e,t,n){"use strict";const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function i(e,t,n){Object.prototype.hasOwnProperty.call(e,t)?e[t].push(n):e[t]=[n]}e.exports={format:function(e){return Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t={};if(void 0===e||""===e)return t;for(var n,o,s={},a=!1,u=!1,c=!1,l=-1,f=-1,d=0;d<e.length;d++){const p=e.charCodeAt(d);if(void 0===n)if(-1===f&&1===r[p])-1===l&&(l=d);else if(32===p||9===p)-1===f&&-1!==l&&(f=d);else{if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${d}`);{if(-1===l)throw new SyntaxError(`Unexpected character at index ${d}`);-1===f&&(f=d);const r=e.slice(l,f);44===p?(i(t,r,s),s={}):n=r,l=f=-1}}else if(void 0===o)if(-1===f&&1===r[p])-1===l&&(l=d);else if(32===p||9===p)-1===f&&-1!==l&&(f=d);else if(59===p||44===p){if(-1===l)throw new SyntaxError(`Unexpected character at index ${d}`);-1===f&&(f=d),i(s,e.slice(l,f),!0),44===p&&(i(t,n,s),s={},n=void 0),l=f=-1}else{if(61!==p||-1===l||-1!==f)throw new SyntaxError(`Unexpected character at index ${d}`);o=e.slice(l,d),l=f=-1}else if(u){if(1!==r[p])throw new SyntaxError(`Unexpected character at index ${d}`);-1===l?l=d:a||(a=!0),u=!1}else if(c)if(1===r[p])-1===l&&(l=d);else if(34===p&&-1!==l)c=!1,f=d;else{if(92!==p)throw new SyntaxError(`Unexpected character at index ${d}`);u=!0}else if(34===p&&61===e.charCodeAt(d-1))c=!0;else if(-1===f&&1===r[p])-1===l&&(l=d);else if(-1===l||32!==p&&9!==p){if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${d}`);if(-1===l)throw new SyntaxError(`Unexpected character at index ${d}`);-1===f&&(f=d);var h=e.slice(l,f);a&&(h=h.replace(/\\/g,""),a=!1),i(s,o,h),44===p&&(i(t,n,s),s={},n=void 0),o=void 0,l=f=-1}else-1===f&&(f=d)}if(-1===l||c)throw new SyntaxError("Unexpected end of input");-1===f&&(f=d);const p=e.slice(l,f);return void 0===n?i(t,p,{}):(void 0===o?i(s,p,!0):i(s,o,a?p.replace(/\\/g,""):p),i(t,n,s)),t}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";const r=n(78),i=n(42),o=n(49),s=n(34),a=n(139),u=n(138),c=n(33),l=n(32),f=n(135),d=n(77),h=n(24),p=n(76),m=n(74),v=["CONNECTING","OPEN","CLOSING","CLOSED"],_=h.kWebSocket,g=[8,13],y=3e4;class b extends r{constructor(e,t,n){super(),this.readyState=b.CONNECTING,this.protocol="",this._binaryType=h.BINARY_TYPES[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._isServer=!0,this._receiver=null,this._sender=null,this._socket=null,null!==e&&(Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(n=t,t=void 0),function(e,t,n){if(n=Object.assign({protocolVersion:g[1],perMessageDeflate:!0},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0}),-1===g.indexOf(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} `+`(supported versions: ${g.join(", ")})`);var r;this._isServer=!1,"object"==typeof e&&void 0!==e.href?(r=e,this.url=e.href):(r=c.parse(e),this.url=e);const a="ws+unix:"===r.protocol;if(!(r.host||a&&r.pathname))throw new Error(`Invalid URL: ${this.url}`);const u="wss:"===r.protocol||"https:"===r.protocol,f=i.randomBytes(16).toString("base64"),p=u?o:s,m=r.search?`${r.pathname||"/"}${r.search}`:r.pathname||"/";var v;n.createConnection=u?S:w,n.port=r.port||(u?443:80),n.host=r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,n.headers=Object.assign({"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":f,Connection:"Upgrade",Upgrade:"websocket"},n.headers),n.path=m,n.perMessageDeflate&&(v=new l(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1),n.headers["Sec-WebSocket-Extensions"]=d.format({[l.extensionName]:v.offer()}));t&&(n.headers["Sec-WebSocket-Protocol"]=t);n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin);r.auth?n.auth=r.auth:(r.username||r.password)&&(n.auth=`${r.username}:${r.password}`);if(a){const e=m.split(":");null==n.agent&&process.versions.modules<57?n._socketPath=e[0]:n.socketPath=e[0],n.path=e[1]}var _=this._req=p.get(n);n.handshakeTimeout&&_.setTimeout(n.handshakeTimeout,C.bind(null,this,_,"Opening handshake has timed out"));_.on("error",e=>{this._req.aborted||(_=this._req=null,this.readyState=b.CLOSING,this.emit("error",e),this.emitClose())}),_.on("response",e=>{this.emit("unexpected-response",_,e)||C(this,_,`Unexpected server response: ${e.statusCode}`)}),_.on("upgrade",(e,n,r)=>{if(this.emit("upgrade",e),this.readyState!==b.CONNECTING)return;_=this._req=null;const o=i.createHash("sha1").update(f+h.GUID,"binary").digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void C(this,n,"Invalid Sec-WebSocket-Accept header");const s=e.headers["sec-websocket-protocol"],a=(t||"").split(/, */);var u;if(!t&&s?u="Server sent a subprotocol but none was requested":t&&!s?u="Server sent no subprotocol":s&&-1===a.indexOf(s)&&(u="Server sent an invalid subprotocol"),u)C(this,n,u);else{if(s&&(this.protocol=s),v)try{const t=d.parse(e.headers["sec-websocket-extensions"]);t[l.extensionName]&&(v.accept(t[l.extensionName]),this._extensions[l.extensionName]=v)}catch(e){return void C(this,n,"Invalid Sec-WebSocket-Extensions header")}this.setSocket(n,r,0)}})}.call(this,e,t,n))}get CONNECTING(){return b.CONNECTING}get CLOSING(){return b.CLOSING}get CLOSED(){return b.CLOSED}get OPEN(){return b.OPEN}get binaryType(){return this._binaryType}set binaryType(e){h.BINARY_TYPES.indexOf(e)<0||(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){const r=new p(this._binaryType,this._extensions,n);this._sender=new m(e,this._extensions),this._receiver=r,this._socket=e,r[_]=this,e[_]=this,r.on("conclude",k),r.on("drain",E),r.on("error",O),r.on("message",T),r.on("ping",I),r.on("pong",N),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",P),e.on("data",A),e.on("end",L),e.on("error",M),this.readyState=b.OPEN,this.emit("open")}emitClose(){this.readyState=b.CLOSED,this._socket?(this._extensions[l.extensionName]&&this._extensions[l.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){const e="WebSocket was closed before the connection was established";return C(this,this._req,e)}this.readyState!==b.CLOSING?(this.readyState=b.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,this._socket.writable&&(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),y)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==b.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${v[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.ping(e||h.EMPTY_BUFFER,t,n)}pong(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==b.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${v[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.pong(e||h.EMPTY_BUFFER,t,n)}send(e,t,n){if("function"==typeof t&&(n=t,t={}),this.readyState!==b.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${v[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=e.toString());const r=Object.assign({binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[l.extensionName]||(r.compress=!1),this._sender.send(e||h.EMPTY_BUFFER,r,n)}terminate(){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){const e="WebSocket was closed before the connection was established";return C(this,this._req,e)}this._socket&&(this.readyState=b.CLOSING,this._socket.destroy())}}}function w(e){return e.path=e.socketPath||e._socketPath||void 0,a.connect(e)}function S(e){return e.path=e.socketPath||e._socketPath||void 0,e.servername=e.servername||e.host,u.connect(e)}function C(e,t,n){e.readyState=b.CLOSING;const r=new Error(n);Error.captureStackTrace(r,C),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function k(e,t){const n=this[_];n._socket.removeListener("data",A),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,1005===e?n.close():n.close(e,t)}function E(){this[_]._socket.resume()}function O(e){const t=this[_];t.readyState=b.CLOSING,t._closeCode=e[h.kStatusCode],t.emit("error",e),t._socket.destroy()}function x(){this[_].emitClose()}function T(e){this[_].emit("message",e)}function I(e){const t=this[_];t.pong(e,!t._isServer,h.NOOP),t.emit("ping",e)}function N(e){this[_].emit("pong",e)}function P(){const e=this[_];this.removeListener("close",P),this.removeListener("data",A),this.removeListener("end",L),this[_]=void 0,e.readyState=b.CLOSING,e._socket.read(),e._receiver.end(),clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",x),e._receiver.on("finish",x))}function A(e){this[_]._receiver.write(e)||this.pause()}function L(){const e=this[_];e.readyState=b.CLOSING,e._receiver.end(),this.end()}function M(){const e=this[_];this.removeListener("error",M),this.on("error",h.NOOP),e&&(e.readyState=b.CLOSING,this.destroy())}v.forEach((e,t)=>{b[v[t]]=t}),["open","error","close","message"].forEach(e=>{Object.defineProperty(b.prototype,`on${e}`,{get(){const t=this.listeners(e);for(var n=0;n<t.length;n++)if(t[n]._listener)return t[n]._listener},set(t){const n=this.listeners(e);for(var r=0;r<n.length;r++)n[r]._listener&&this.removeListener(e,n[r]);this.addEventListener(e,t)}})}),b.prototype.addEventListener=f.addEventListener,b.prototype.removeEventListener=f.removeEventListener,e.exports=b},function(e,t,n){var r=n(83),i=n(53).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(58),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(44);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(12),i=n(18),o=n(158)(!1),s=n(55)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){e.exports=n(15)},function(e,t,n){e.exports=!n(11)&&!n(23)(function(){return 7!=Object.defineProperty(n(65)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r=n(45),i=n(14),o=n(84),s=n(15),a=n(27),u=n(160),c=n(43),l=n(109),f=n(6)("iterator"),d=!([].keys&&"next"in[].keys()),h=function(){return this};e.exports=function(e,t,n,p,m,v,_){u(n,t,p);var g,y,b,w=function(e){if(!d&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",C="values"==m,k=!1,E=e.prototype,O=E[f]||E["@@iterator"]||m&&E[m],x=O||w(m),T=m?C?w("entries"):x:void 0,I="Array"==t&&E.entries||O;if(I&&(b=l(I.call(new e)))!==Object.prototype&&b.next&&(c(b,S,!0),r||"function"==typeof b[f]||s(b,f,h)),C&&O&&"values"!==O.name&&(k=!0,x=function(){return O.call(this)}),r&&!_||!d&&!k&&E[f]||s(E,f,x),a[t]=x,a[S]=h,m)if(g={values:C?x:w("values"),keys:v?x:w("keys"),entries:T},_)for(y in g)y in E||o(E,y,g[y]);else i(i.P+i.F*(d||k),t,g);return g}},function(e,t){e.exports=require("process")},function(e,t){e.exports=require("os")},,function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(8),s=n(17).upload,a=n(17).chunkUpload,u=n(17).abort,c=i.supportFormData;function l(e){var t=this;t.options=i.copy(e),i.verifyOptions(e,"url fileName"),i.verifyParamPresentJustOne(e,"blob fileInput"),i.verifyCallback(e,"beginupload uploadprogress uploaddone"),e.fileInput&&(e.fileInput=i.verifyFileInput(e.fileInput)),e.type&&i.verifyFileType(e.type),e.timeout?i.verifyParamType("timeout",e.timeout,"number"):e.timeout=6e5,i.verifyFileUploadCallback(e),e.data={},e.params&&i.merge(e.data,e.params);var n=e.fileName,u=e.fileInput;if(c){if(u){var l=e.type?i.filterFiles(u.files,e.type):[].slice.call(u.files,0);if(!l||!l.length)return void e.uploaddone(o.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+e.type+"类型的文件"));e.data[n]=l[0];var f=u.files[0].size}else if(e.blob){if(e.data[n]=e.blob,"file"!==e.type&&e.blob.type&&-1===e.blob.type.indexOf(e.type))return void e.uploaddone(o.newWrongFileTypeError("未读取到"+e.type+"类型的文件, 请确保选择了"+e.type+"类型的文件"));f=e.blob.size}if(e.maxSize&&f>e.maxSize)return void e.uploaddone(o.newFileTooLargeError("上传文件大小超过"+e.maxSize+"限制"));if(!e.commonUpload)return f>r.chunkMaxSize?void e.uploaddone(o.newFileTooLargeError("直传文件大小超过"+r.chunkMaxSize+"限制")):void(t.sn=a(e,n,t,-1));if(f>r.commonMaxSize)return void e.uploaddone(o.newFileTooLargeError("普通上传文件大小超过"+r.commonMaxSize+"限制"))}else i.dataset(u,"name",n),e.data.input=u;var d={data:e.data,onaftersend:function(){e.beginupload(t)},onuploading:function(t){var n=Math.floor(1e4*t.loaded/t.total)/100,r={docId:e.docId,total:t.total,loaded:t.loaded,percentage:n,percentageText:n+"%"};e.fileInput&&(r.fileInput=e.fileInput),e.blob&&(r.blob=e.blob),e.uploadprogress(r)},onload:function(n){n.docId=e.docId,n.Error?t.onError(n):e.uploaddone(null,n)},onerror:function(n){try{if(n.result)var r=JSON.parse(n.result);else r=n;t.onError(r)}catch(r){console.log("error: ignore error if could not parse obj.result",r),e.uploaddone(new o(n.message,n.code),t.options)}}};c||(d.mode="iframe"),d.putFileAtEnd=!0,t.sn=s(e.url,d)}l.prototype.onError=function(e){var t,n,r,i=this.options;n=(t=(e=e||{}).Error||e||{}).Code||t.code||"unknown",r=t.Message||t.message||"未知错误",i.uploaddone(new o(n+"("+r+")",n))},l.prototype.abort=function(){u(this.sn)},e.exports=l},function(e,t){e.exports=function(e,t){var n=t.split(".");for(;n.length;){var r=n.shift(),i=!1;if("?"==r[r.length-1]&&(r=r.slice(0,-1),i=!0),!(e=e[r])&&i)return e}return e}},function(e,t){e.exports=function e(t,n){"use strict";var r,i,o=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,s=/(^[ ]*|[ ]*$)/g,a=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,c=/^0/,l=function(t){return e.insensitive&&(""+t).toLowerCase()||""+t},f=l(t).replace(s,"")||"",d=l(n).replace(s,"")||"",h=f.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=d.replace(o,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),m=parseInt(f.match(u),16)||1!==h.length&&f.match(a)&&Date.parse(f),v=parseInt(d.match(u),16)||m&&d.match(a)&&Date.parse(d)||null;if(v){if(m<v)return-1;if(m>v)return 1}for(var _=0,g=Math.max(h.length,p.length);_<g;_++){if(r=!(h[_]||"").match(c)&&parseFloat(h[_])||h[_]||0,i=!(p[_]||"").match(c)&&parseFloat(p[_])||p[_]||0,isNaN(r)!==isNaN(i))return isNaN(r)?1:-1;if(typeof r!=typeof i&&(r+="",i+=""),r<i)return-1;if(r>i)return 1}return 0}},,,,,,function(e,t){},function(e,t,n){var r=n(35),i=n(28),o=n(18),s=n(56),a=n(12),u=n(85),c=Object.getOwnPropertyDescriptor;t.f=n(11)?c:function(e,t){if(e=o(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(3).document;e.exports=r&&r.documentElement},function(e,t,n){"use strict";n(166).autoPolyfill();var r=n(1);r.defaultReportUrl=null,r.isNodejs=!0,n(90).uploadFile=n(120)},,,,,,,,function(e,t,n){var r=n(12),i=n(61),o=n(55)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},,,,,,,,,,function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=s(n(2)),i=s(n(40)),o=s(n(39));function s(e){return e&&e.__esModule?e:{default:e}}var a=n(34),u=n(49),c=n(119),l=n(33),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this._url=t.url,this._fileName=t.name||"file",this._filePath=t.filePath||null,this._fileData=t.fileData||null,this._urlOptions=l.parse(this._url),this._urlOptions.method="POST",this._httpLib=a,"https:"===this._urlOptions.protocol&&(this._httpLib=u),this._params=t.formData||t.params||{},this._onsuccess=t.success||function(){},this._onfail=t.fail||function(){}}return(0,o.default)(e,[{key:"uploadFile",value:function(){var e=this;this._request=this._httpLib.request(this._urlOptions,function(t){var n=null;t.on("data",function(e){e=e.toString(),null===n?n=e:n+=e}),t.on("error",function(t){e._onfail(t),e.destroy()}),t.on("end",function(){var r=Object.assign(Object.create(null),{statusCode:t.statusCode,headers:t.headers});r.data=n,r.errmsg="",e._onsuccess(r),e.destroy()})});var t="Nodejs-"+Math.random().toString(16);if(this._boundaryKey=t,this._filePath){var n=c.statSync(this._filePath);this._size=n.size}else{if(!this._fileData)throw Error("upload file should contains filePath or fileData");this._size=Buffer.byteLength(this._fileData)}var r=this.getPayload(),i="\r\n--"+t+"--";if(this._request.setHeader("Content-Type","multipart/form-data; boundary="+t),this._request.setHeader("Content-Length",Buffer.byteLength(r)+Buffer.byteLength(i)+this._size),this._request.write(r),this._filePath){var o=c.createReadStream(this._filePath,{bufferSize:4096});o.pipe(this._request,{end:!1}),o.on("end",function(){e._request.end(i)})}else this._fileData&&(this._request.write(this._fileData),this._request.end(i))}},{key:"getPayload",value:function(){var e=this,t="";return Object.keys(this._params).forEach(function(n){var i=e._params[n];"object"!==(void 0===i?"undefined":(0,r.default)(i))&&(t+="--"+e._boundaryKey+'\r\nContent-Disposition: form-data; name="'+n+'"\r\n\r\n'+i+"\r\n")}),t+="--"+this._boundaryKey+'\r\nContent-Disposition: form-data; name="file"; filename='+this._fileName+"\r\nContent-Transfer-Encoding: binary\r\n\r\n"}},{key:"destroy",value:function(){var e=this;Object.keys(this).forEach(function(t){delete e[t]})}}]),e}();e.exports=function(e){new f(e).uploadFile()}},function(e,t,n){"use strict";var r=n(1),i=r.chunkSize,o=n(30),s={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};e.exports=function e(t,n,a,u){var c={file:t.data[n],fileSize:t.data[n].size,fileUploadedSize:0,percentage:0},l=t.url;function f(e){var n=c.fileUploadedSize+e.loaded,r=Math.floor(1e4*n/c.fileSize)/100;if(parseInt(r)>=100&&(r=100,f=function(){}),c.percentage!==r){c.percentage=r;var i={docId:t.docId,total:c.fileSize,loaded:n,percentage:r,percentageText:r+"%"};t.fileInput&&(i.fileInput=t.fileInput),t.blob&&(i.blob=t.blob),t.uploadprogress(i)}}function d(e){try{e=JSON.parse(e)}catch(e){return void a.onError(e)}if(e.errMsg||e.errCode)a.onError(e);else if(e.offset<c.fileSize)delete v.onaftersend,c.fileUploadedSize=e.offset,a.sn=function(e,t,n,r){var s=e.offset,a=e.offset+i;return t.data=r.file.slice(s,a),t.query.offset=e.offset,t.query.complete=a>=r.fileSize,t.query.context=e.context,t.onuploading=f,t.onload=d,t.onerror=h,o(l,t)}(e,v,0,c);else{var n=r.genFileUrl(t.nosToken);"image"===t.type?o(n+"?imageInfo",{onload:function(n){try{n=JSON.parse(n),t.uploaddone(null,{docId:e.docId,w:n.Width,h:n.Height,orientation:n.Orientation||"",type:n.Type,size:n.Size||c.fileSize})}catch(e){s(e)}},onerror:function(r){if("undefined"!=typeof Image){var i=new Image;i.src=n,i.onload=function(){t.uploaddone(null,{docId:e.docId,w:i.width,h:i.height,size:c.fileSize})}}else s(r)}}):"video"===t.type||"audio"===t.type?o(n+"?vinfo",{onload:function(n){try{(n=JSON.parse(n)).GetVideoInfo&&n.GetVideoInfo.VideoInfo&&(n=n.GetVideoInfo.VideoInfo),t.uploaddone(null,{docId:e.docId,w:n.Width,h:n.Height,dur:n.Duration,orientation:n.Rotate,audioCodec:n.AudioCodec,videoCodec:n.VideoCodec,container:n.Container,size:n.Size||c.fileSize})}catch(e){s(e)}},onerror:s}):t.uploaddone(null,{docId:e.docId,size:c.fileSize})}function s(e){a.onError(e)}}function h(r){var i,s,l,f=r&&r.code;function d(){try{if(r.result)var e=JSON.parse(r.result);else e=r;a.onError(e)}catch(e){a.onError(e)}}0===c.fileUploadedSize&&t.nosLbsUrls&&t.nosLbsUrls.length>0&&"abort"!==f?t.edgeList?u<t.edgeList.length-1?e(t,n,a,u+1):d():(i=0,s=t.nosToken.bucket,l=t.nosLbsUrls,new Promise(function(e,t){function n(){o(l[i],{query:{version:"1.0",bucketname:s},method:"GET",onerror:r,onload:function(t){try{(t=JSON.parse(t))&&t.upload&&t.upload.length?e(t.upload):r()}catch(e){r()}}})}function r(){i<l.length-1?(i++,n()):e([])}n()})).then(function(r){r.length>0?(t.edgeList=r,t.updateNosEdgeList&&t.updateNosEdgeList(r),e(t,n,a,u+1)):d()}):d()}"number"!=typeof u&&(u=-1),t.edgeList&&t.edgeList.length&&(u=u>0?u:0,l=t.edgeList[u]),l+="/"+t.nosToken.bucket+"/"+t.nosToken.objectName;var p=t.data.file&&t.data.file.type;if(!p||p.indexOf("/")<0){var m=(t.fileInputName||"").split(".").pop();"image"===t.type?p="image/"+("jpg"===m?"jpeg":m):"audio"!==t.type&&"video"!==t.type||(p=s[m])}var v={query:{offset:0,complete:i>=c.fileSize,version:"1.0"},headers:{"Content-Type":p||"application/octet-stream","x-nos-token":t.nosToken.token},method:"POST",timeout:0,onaftersend:function(){t.beginupload(a)},onuploading:f,onload:d,onerror:h};return v.data=c.file.slice(0,i),o(l,v)}},function(e,t,n){"use strict";var r=n(30);e.exports=function(e,t){return t.method="POST",t.headers=t.headers||{},t.headers["Content-Type"]="multipart/form-data",t.timeout=0,t.type=t.type||"json",r(e,t)}},function(e,t,n){"use strict";var r,i,o=n(9),s=n(30),a=(r=/json/i,i=/post/i,function(e,t){var n=(t=t||{}).data=t.data||{},a=t.headers=t.headers||{},u=o.checkWithDefault(a,"Accept","application/json"),c=o.checkWithDefault(a,"Content-Type","application/json");return r.test(u)&&(t.type="json"),i.test(t.method)&&r.test(c)&&(t.data=JSON.stringify(n)),s(e,t)});e.exports=a},function(e,t,n){"use strict";var r=n(9),i=n(73),o=n(47),s={};function a(e){this.init(),o.call(this,e)}var u=o.prototype,c=a.prototype=Object.create(u);c.init=function(){var e="NEJ-AJAX-DATA:",t=!1;function n(t){var n=t.data;if(0===n.indexOf(e)){var r=(n=JSON.parse(n.replace(e,""))).key,i=s[r];i&&(delete s[r],n.result=decodeURIComponent(n.result||""),i.onLoad(n))}}return function(){!function(){if(!t){t=!0;var e=r.getGlobal();e.postMessage?r.on(e,"message",n):i.addMsgListener(n)}}()}}(),c.doSend=function(){var e=this.options,t=r.url2origin(e.url),n=e.proxyUrl||t+"/res/nej_proxy_frame.html",o=s[n];if(r.isArray(o))o.push(this.doSend.bind(this,e));else{if(!o)return s[n]=[this.doSend.bind(this,e)],void r.createIframe({src:n,onload:function(e){var t=s[n];s[n]=r.target(e).contentWindow,t.forEach(function(e){try{e()}catch(e){console.log("error:",e)}})}});if(!this.aborted){var a=this.key=r.uniqueID();s[a]=this;var u=r.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},e);u.key=a,i.postMessage(o,{data:u}),this.afterSend()}}},c.abort=function(){this.aborted=!0,delete s[this.key],u.abort.call(this)},e.exports=a},function(e,t,n){"use strict";var r=n(9),i=n(47),o=n(73),s="NEJ-UPLOAD-RESULT:",a={};function u(e){this.init(),i.call(this,e)}var c=i.prototype,l=u.prototype=Object.create(c);l.init=function(){var e=!1;function t(e){var t=e.data;if(0===t.indexOf(s)){var n=(t=JSON.parse(t.replace(s,""))).key,r=a[n];r&&(delete a[n],t.result=decodeURIComponent(t.result||""),r.onLoad(t.result))}}return function(){!function(){if(!e){e=!0;var n=r.getGlobal();n.postMessage?r.on(n,"message",t):(o.addMsgListener(t),o.startTimer())}}()}}(),l.doSend=function(){var e=this,t=e.options,n=e.key="zoro-ajax-upload-iframe-"+r.uniqueID();a[n]=e;var i=e.form=r.html2node('<form style="display:none;"></form>');"undefined"==typeof document?console.log("error: document is undefined"):document.body.appendChild(i),i.target=n,i.method="POST",i.enctype="multipart/form-data",i.encoding="multipart/form-data";var o=t.url,s=r.genUrlSep(o);i.action=o+s+"_proxy_=form";var u=t.data,c=[],l=[];function f(){c.forEach(function(e,t){var n=l[t];n.parentNode&&(e.name=n.name,r.isFunction(e.setAttribute)&&e.setAttribute("form",n.getAttribute("form")),n.parentNode.replaceChild(e,n))})}u&&r.getKeys(u,t.putFileAtEnd).forEach(function(e){var t=u[e];if(t.tagName&&"INPUT"===t.tagName.toUpperCase()){if("file"===t.type){var n=t,o=n.cloneNode(!0);n.parentNode.insertBefore(o,n);var s=r.dataset(n,"name");s&&(n.name=s),i.appendChild(n),r.isFunction(n.setAttribute)&&(n.setAttribute("form",""),n.removeAttribute("form")),c.push(t),l.push(o)}}else{var a=r.html2node('<input type="hidden"/>');a.name=e,a.value=t,i.appendChild(a)}});var d=e.iframe=r.createIframe({name:n,onload:function(){e.aborted?f():(r.on(d,"load",e.checkResult.bind(e)),i.submit(),f(),e.afterSend())}})},l.checkResult=function(){var e,t;try{if((t=((e=this.iframe.contentWindow.document.body).innerText||e.textContent||"").trim()).indexOf(s)>=0||e.innerHTML.indexOf(s)>=0)return}catch(e){return void console.log("error:","ignore error if not same domain,",e)}this.onLoad(t)},l.onLoad=function(e){c.onLoad.call(this,{status:200,result:e}),r.remove(this.form),r.remove(this.iframe),c.destroy.call(this)},l.destroy=function(){r.remove(this.iframe),r.remove(this.form)},l.abort=function(){this.aborted=!0,delete a[this.key],c.abort.call(this)},e.exports=u},function(e,t,n){var r;
/*!
 * EventEmitter v5.2.4 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function i(){}var o=i.prototype,s=t.EventEmitter;function a(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function u(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===a(r[n],t)&&r[n].push(i?t:{listener:t,once:!1});return this},o.on=u("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=u("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(n=a(i[r],t))&&i[r].splice(n,1);return this},o.off=u("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):s.call(this,r,i));return this},o.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},o.removeAllListeners=u("removeEvent"),o.emitEvent=function(e,t){var n,r,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},o.trigger=u("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=s,i},void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}(this||{})},function(e,t,n){"use strict";var r=n(9),i=n(47);function o(e){e.onuploading&&this.on("uploading",e.onuploading),i.call(this,e)}var s=i.prototype,a=o.prototype=Object.create(s);a.doSend=function(){var e=this.options,t=e.headers,n=this.xhr=new XMLHttpRequest;if("multipart/form-data"===t["Content-Type"]){delete t["Content-Type"],n.upload.onprogress=this.onProgress.bind(this),n.upload.onload=this.onProgress.bind(this);var i=e.data;e.data=new window.FormData,i&&r.getKeys(i,e.putFileAtEnd).forEach(function(t){var n=i[t];n.tagName&&"INPUT"===n.tagName.toUpperCase()?"file"===n.type&&[].forEach.call(n.files,function(t){e.data.append(r.dataset(n,"name")||n.name||t.name||"file-"+r.uniqueID(),t)}):e.data.append(t,n)})}else t["x-nos-token"]&&(n.upload.onprogress=this.onProgress.bind(this),n.upload.onload=this.onProgress.bind(this));n.onreadystatechange=this.onStateChange.bind(this),0!==e.timeout&&(this.timer=setTimeout(this.onTimeout.bind(this),e.timeout)),n.open(e.method,e.url,!e.sync),Object.keys(t).forEach(function(e){n.setRequestHeader(e,t[e])}),e.cookie&&"withCredentials"in n&&(n.withCredentials=!0),n.send(e.data),this.afterSend()},a.onProgress=function(e){e.lengthComputable&&e.loaded<=e.total&&this.emit("uploading",e)},a.onStateChange=function(){var e,t=this.xhr;4===t.readyState&&(e={status:t.status,result:t.responseText||""},this.onLoad(e))},a.getResponseHeader=function(e){var t=this.xhr;return t?t.getResponseHeader(e):""},a.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=r.f,this.xhr.abort()}catch(e){console.log("error:","ignore error ajax destroy,",e)}s.destroy.call(this)},e.exports=o},function(e,t,n){"use strict";var r=n(1);"undefined"!=typeof window&&(window.console||r.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(e,t,n){"use strict";var r=n(37),i=n(50),o=n(35),s=n(61),a=n(82),u=Object.assign;e.exports=!u||n(23)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=s(e),u=arguments.length,c=1,l=i.f,f=o.f;u>c;)for(var d,h=a(arguments[c++]),p=l?r(h).concat(l(h)):r(h),m=p.length,v=0;m>v;)f.call(h,d=p[v++])&&(n[d]=h[d]);return n}:u},function(e,t,n){var r=n(14);r(r.S+r.F,"Object",{assign:n(129)})},function(e,t,n){n(130),e.exports=n(4).Object.assign},function(e,t,n){e.exports={default:n(131),__esModule:!0}},function(e,t,n){"use strict";const r=n(78),i=n(42),o=n(34),s=n(33),a=n(32),u=n(77),c=n(24),l=n(79);function f(){this.destroy()}function d(e,t,n){e.writable&&(n=n||o.STATUS_CODES[t],e.write(`HTTP/1.1 ${t} ${o.STATUS_CODES[t]}\r\n`+"Connection: close\r\nContent-type: text/html\r\n"+`Content-Length: ${Buffer.byteLength(n)}\r\n`+"\r\n"+n)),e.removeListener("error",f),e.destroy()}e.exports=class extends r{constructor(e,t){if(super(),null==(e=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=e.port?(this._server=o.createServer((e,t)=>{const n=o.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,n)=>{this.handleUpgrade(e,t,n,t=>{this.emit("connection",t,e)})}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this.clients)for(const e of this.clients)e.terminate();const t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port))return t.close(e);e&&e()}shouldHandle(e){return!this.options.path||s.parse(e.url).pathname===this.options.path}handleUpgrade(e,t,n,r){t.on("error",f);const i=+e.headers["sec-websocket-version"],o={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!e.headers["sec-websocket-key"]||8!==i&&13!==i||!this.shouldHandle(e))return d(t,400);if(this.options.perMessageDeflate){const n=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const r=u.parse(e.headers["sec-websocket-extensions"]);r[a.extensionName]&&(n.accept(r[a.extensionName]),o[a.extensionName]=n)}catch(e){return d(t,400)}}if(this.options.verifyClient){const s={origin:e.headers[`${8===i?"sec-websocket-origin":"origin"}`],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(s,(i,s,a)=>{if(!i)return d(t,s||401,a);this.completeUpgrade(o,e,t,n,r)});if(!this.options.verifyClient(s))return d(t,401)}this.completeUpgrade(o,e,t,n,r)}completeUpgrade(e,t,n,r,o){if(!n.readable||!n.writable)return n.destroy();const s=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${i.createHash("sha1").update(t.headers["sec-websocket-key"]+c.GUID,"binary").digest("base64")}`],d=new l(null);var h=t.headers["sec-websocket-protocol"];if(h&&(h=h.trim().split(/ *, */),(h=this.options.handleProtocols?this.options.handleProtocols(h,t):h[0])&&(s.push(`Sec-WebSocket-Protocol: ${h}`),d.protocol=h)),e[a.extensionName]){const t=e[a.extensionName].params,n=u.format({[a.extensionName]:[t]});s.push(`Sec-WebSocket-Extensions: ${n}`),d._extensions=e}this.emit("headers",s,t),n.write(s.concat("\r\n").join("\r\n")),n.removeListener("error",f),d.setSocket(n,r,this.options.maxPayload),this.clients&&(this.clients.add(d),d.on("close",()=>this.clients.delete(d))),o(d)}}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";class r{constructor(e,t){this.target=t,this.type=e}}class i extends r{constructor(e,t){super("message",t),this.data=e}}class o extends r{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}}class s extends r{constructor(e){super("open",e)}}class a extends r{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const u={addEventListener(e,t){function n(e){t.call(this,new i(e,this))}function r(e,n){t.call(this,new o(e,n,this))}function u(e){t.call(this,new a(e,this))}function c(){t.call(this,new s(this))}"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(u._listener=t,this.on(e,u)):"open"===e?(c._listener=t,this.on(e,c)):this.on(e,t))},removeEventListener(e,t){const n=this.listeners(e);for(var r=0;r<n.length;r++)n[r]!==t&&n[r]._listener!==t||this.removeListener(e,n[r])}};e.exports=u},function(e,t){e.exports=require("zlib")},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}["push","unshift","splice"].forEach(function(e){r.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}}),Object.defineProperty(r.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),r.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},r.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this._run())},e.exports=r},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("net")},function(e,t,n){"use strict";const r=n(79);r.Server=n(133),r.Receiver=n(76),r.Sender=n(74),e.exports=r},function(e,t,n){"use strict";e.exports=n(140)},function(e,t,n){var r=n(14);r(r.S+r.F*!n(11),"Object",{defineProperty:n(10).f})},function(e,t,n){n(142);var r=n(4).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){e.exports={default:n(143),__esModule:!0}},function(e,t,n){n(51)("observable")},function(e,t,n){n(51)("asyncIterator")},function(e,t,n){var r=n(18),i=n(80).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(r(e))}},function(e,t,n){var r=n(44);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(37),i=n(50),o=n(35);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),u=o.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},function(e,t,n){var r=n(36)("meta"),i=n(19),o=n(12),s=n(10).f,a=0,u=Object.isExtensible||function(){return!0},c=!n(23)(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!o(e,r)&&l(e),e}}},function(e,t,n){"use strict";var r=n(3),i=n(12),o=n(11),s=n(14),a=n(84),u=n(150).KEY,c=n(23),l=n(54),f=n(43),d=n(36),h=n(6),p=n(52),m=n(51),v=n(149),_=n(148),g=n(13),y=n(19),b=n(18),w=n(56),S=n(28),C=n(67),k=n(147),E=n(99),O=n(10),x=n(37),T=E.f,I=O.f,N=k.f,P=r.Symbol,A=r.JSON,L=A&&A.stringify,M=h("_hidden"),j=h("toPrimitive"),U={}.propertyIsEnumerable,B=l("symbol-registry"),R=l("symbols"),W=l("op-symbols"),D=Object.prototype,F="function"==typeof P,H=r.QObject,q=!H||!H.prototype||!H.prototype.findChild,J=o&&c(function(){return 7!=C(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=T(D,t);r&&delete D[t],I(e,t,n),r&&e!==D&&I(D,t,r)}:I,z=function(e){var t=R[e]=C(P.prototype);return t._k=e,t},$=F&&"symbol"==typeof P.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof P},G=function(e,t,n){return e===D&&G(W,t,n),g(e),t=w(t,!0),g(n),i(R,t)?(n.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),n=C(n,{enumerable:S(0,!1)})):(i(e,M)||I(e,M,S(1,{})),e[M][t]=!0),J(e,t,n)):I(e,t,n)},V=function(e,t){g(e);for(var n,r=v(t=b(t)),i=0,o=r.length;o>i;)G(e,n=r[i++],t[n]);return e},Y=function(e){var t=U.call(this,e=w(e,!0));return!(this===D&&i(R,e)&&!i(W,e))&&(!(t||!i(this,e)||!i(R,e)||i(this,M)&&this[M][e])||t)},K=function(e,t){if(e=b(e),t=w(t,!0),e!==D||!i(R,t)||i(W,t)){var n=T(e,t);return!n||!i(R,t)||i(e,M)&&e[M][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=N(b(e)),r=[],o=0;n.length>o;)i(R,t=n[o++])||t==M||t==u||r.push(t);return r},Z=function(e){for(var t,n=e===D,r=N(n?W:b(e)),o=[],s=0;r.length>s;)!i(R,t=r[s++])||n&&!i(D,t)||o.push(R[t]);return o};F||(a((P=function(){if(this instanceof P)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===D&&t.call(W,n),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),J(this,e,S(1,n))};return o&&q&&J(D,e,{configurable:!0,set:t}),z(e)}).prototype,"toString",function(){return this._k}),E.f=K,O.f=G,n(80).f=k.f=Q,n(35).f=Y,n(50).f=Z,o&&!n(45)&&a(D,"propertyIsEnumerable",Y,!0),p.f=function(e){return z(h(e))}),s(s.G+s.W+s.F*!F,{Symbol:P});for(var X="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;X.length>ee;)h(X[ee++]);for(var te=x(h.store),ne=0;te.length>ne;)m(te[ne++]);s(s.S+s.F*!F,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=P(e)},keyFor:function(e){if(!$(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){q=!0},useSimple:function(){q=!1}}),s(s.S+s.F*!F,"Object",{create:function(e,t){return void 0===t?C(e):V(C(e),t)},defineProperty:G,defineProperties:V,getOwnPropertyDescriptor:K,getOwnPropertyNames:Q,getOwnPropertySymbols:Z}),A&&s(s.S+s.F*(!F||c(function(){var e=P();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(y(t)||void 0!==e)&&!$(e))return _(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!$(t))return t}),r[1]=t,L.apply(A,r)}}),P.prototype[j]||n(15)(P.prototype,j,P.prototype.valueOf),f(P,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){n(151),n(98),n(146),n(145),e.exports=n(4).Symbol},function(e,t,n){e.exports={default:n(152),__esModule:!0}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=function(){}},function(e,t,n){"use strict";var r=n(155),i=n(154),o=n(27),s=n(18);e.exports=n(86)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var r=n(58),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},function(e,t,n){var r=n(18),i=n(81),o=n(157);e.exports=function(e){return function(t,n,s){var a,u=r(t),c=i(u.length),l=o(s,c);if(e&&n!=n){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(10),i=n(13),o=n(37);e.exports=n(11)?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,u=0;a>u;)r.f(e,n=s[u++],t[n]);return e}},function(e,t,n){"use strict";var r=n(67),i=n(28),o=n(43),s={};n(15)(s,n(6)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(58),i=n(57);e.exports=function(e){return function(t,n){var o,s,a=String(i(t)),u=r(n),c=a.length;return u<0||u>=c?e?"":void 0:(o=a.charCodeAt(u))<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):s-56320+(o-55296<<10)+65536}}},function(e,t,n){n(59),n(64),e.exports=n(52).f("iterator")},function(e,t,n){e.exports={default:n(162),__esModule:!0}},function(e,t,n){"use strict";var r=s(n(2)),i=s(n(40)),o=s(n(39));function s(e){return e&&e.__esModule?e:{default:e}}var a=n(34),u=n(49),c=n(33),l=0,f=4;var d=function(){function e(){(0,i.default)(this,e),this.readyState=l,this._options={},this._request=null}return(0,o.default)(e,[{key:"dispatchEvent",value:function(e){var t="on"+e.type;"function"==typeof this[t]&&this[t](e)}},{key:"abort",value:function(){if(this._request&&this._request.abort)return this.status=0,this.readyState=f,this._request.abort();if(this.readyState===l||!this._request)return this.status=0,this.readyState=f,null;throw new Error("不支持 abort request")}},{key:"getAllResponseHeaders",value:function(){var e=this;return this._responseHeaders?Object.keys(this._responseHeaders).map(function(t){return t+": "+e._responseHeaders[t]}).join("\r\n"):""}},{key:"getResponseHeader",value:function(e){var t=e.toLowerCase();return this._responseHeaders&&this._responseHeaders[t]?this._responseHeaders[t]:null}},{key:"overrideMimeType",value:function(){throw new Error("not supported in nodejs polyfill")}},{key:"open",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.readyState!==l)throw new Error("request is already opened");if(!r)throw new Error("sync request is not supported");this.readyState=1,this._url=t,this._options=Object.assign(this._options,c.parse(t)),this._options.method=e;var i=a;"https:"===this._options.protocol&&(i=u),this._request=i.request(this._options,function(e){var t=null;e.on("data",function(e){e=e.toString(),null===t?t=e:t+=e}),e.on("error",function(e){n.status=0,n.readyState=f,n.dispatchEvent({type:"readystatechange"}),n.dispatchEvent({type:"error"})}),e.on("end",function(){var r=Object.assign(Object.create(null),e);r.data=t,function(e){this.status=e.statusCode,this.statusText=e.statusCode,e.headers&&(this._responseHeaders=Object.keys(e.headers).reduce(function(t,n){return t[n.toLowerCase()]=e.headers[n],t},{}));var t=e.data;"string"!=typeof t&&(t=JSON.stringify(t)),this.responseText=this.response=t,this.readyState=f,this.dispatchEvent({type:"readystatechange"})}.call(n,r)})}),this.timeout&&this._request.setTimeout(this.timeout),this.dispatchEvent({type:"readystatechange"})}},{key:"setRequestHeader",value:function(e,t){if(1!==this.readyState)throw new Error("request is not opened");this._request.setHeader(e,t)}},{key:"send",value:function(e){if(1!==this.readyState)throw new Error("request is not opened");var t=Object.prototype.toString.call(e);"[object Array]"===t||"[object Object]"===t?(e=JSON.stringify(e),this._request.end(e,"utf-8")):"object"===(void 0===e?"undefined":(0,r.default)(e))?this._request.end(e):this._request.end(e,"utf-8")}}]),e}();Object.assign(d,{UNSENT:l,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:f}),e.exports=d},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";n(165);var r=n(88),i=n(87),o={XMLHttpRequest:n(164),WebSocket:n(141),navigator:{userAgent:"Node.js "+i.version,platform:""+r.release},location:Object.create(null),document:null,autoPolyfill:function(){Object.assign(global,o)}};e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHITEBOARD_CONFIG=t.DEFAULT_WHITEBOARD_OPTION=t.WHITEBOARD_CONSTS=void 0;var r,i=n(31),o=(r=i)&&r.__esModule?r:{default:r},s=n(354),a=n(353);t.WHITEBOARD_CONSTS=(0,o.default)({},s.wbMap,a.wbControl),t.DEFAULT_WHITEBOARD_OPTION={debug:!1,isCustom:!0,container:null,remoteContainer:null},t.WHITEBOARD_CONFIG={channelTimeout:30,signalTimeout:18}},function(e,t,n){"use strict";t.__esModule=!0;var r=s(n(363)),i=s(n(359)),o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},function(e,t,n){"use strict";t.__esModule=!0;var r,i=n(2),o=(r=i)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(167),o=function(){};t.default={format:function(e){var t=e.turnInfoTag;return t&&t.constructor===Array?(t.map(function(t){/[01]/.test(t.type)?(e.netcallType=t.type,e.rtcServerMap=t.dispatchServer,e.serverMap=JSON.parse(JSON.stringify(t.dispatchServer))):(e.type=t.type,e.wbServerMap=t.dispatchServer)}),e.netcallType=e.netcallType||i.WHITEBOARD_CONSTS.CALL_TYPE_NONE,e.rtcServerMap&&(e.rtcServerMap=JSON.parse(e.rtcServerMap),e.rtcServerMap=e.rtcServerMap.webrtcarray||[e.rtcServerMap.webrtc]||e.rtcServerMap),e.wbServerMap&&(e.wbServerMap=JSON.parse(e.wbServerMap),e.wbServerMap=e.wbServerMap.webrtcarray||[e.wbServerMap.webrtc]||e.wbServerMap),e.serverAddrs=JSON.parse(JSON.stringify(e.wbServerMap))||[],e):e},pureLogFunc:{asset:o,trace:o,debug:o,log:o,info:o,warn:o,error:o},guid:(r=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return r()+r()+r()+r()+r()+r()+r()+r()}),n2node:function(e){return e?/HTML.+Element/gi.test(e)?e:e[0]&&/HTML.+Element/gi.test(e[0])?e[0]:null:null}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;var r=o(n(40)),i=o(n(39));function o(e){return e&&e.__esModule?e:{default:e}}t.EventEmitter=function(){function e(){(0,r.default)(this,e),this.eventReset()}return(0,i.default)(e,[{key:"eventReset",value:function(){var e=this;this._eventListeners&&Object.keys(this._eventListeners).forEach(function(t){delete e._eventListeners[t]}),this._eventListeners={},this._eventOnceListener&&Object.keys(this._eventOnceListener).forEach(function(t){delete e._eventOnceListener[t]}),this._eventOnceListener={}}},{key:"on",value:function(e,t){if(!e)throw Error({message:"event listener funkey undefined",callFunc:"adapter::wb:_on"});if(!(t instanceof Function))throw Error({message:"event listener next param should be function",callFunc:"adapter::wb:_on"});this._eventListeners[e]=t}},{key:"once",value:function(e,t){if(!e)throw Error({message:"event once listener funkey undefined",callFunc:"adapter::wb:_once"});if(!(t instanceof Function))throw Error({message:"event once listener next param should be function",callFunc:"adapter::wb:_once"});this._eventOnceListener[e]=t}},{key:"emit",value:function(e,t){this._eventOnceListener&&this._eventOnceListener[e]instanceof Function&&(this._eventOnceListener[e](t),delete this._eventOnceListener[e]),this._eventListeners&&this._eventListeners[e]instanceof Function&&this._eventListeners[e](t)}}]),e}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.serializeWb={gateWay:{login:1,loginAck:2,join:3,keep_alive:4,keep_alive_ack:5,keep_alive_node:6,broadcast:7,toUser:8,logout:9}},t.unserializeWb={gateWay:{1:"login",2:"loginAck",3:"join",4:"keep_alive",5:"keep_alive_ack",6:"keep_alive_node",7:"broadcast",8:"toUser",9:"logout"}}},function(e,t,n){var r=n(14),i=n(4),o=n(23);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",s)}},function(e,t,n){"use strict";t.__esModule=!0;var r=o(n(369)),i=o(n(366));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function e(t,n,o){null===t&&(t=Function.prototype);var s=(0,i.default)(t,n);if(void 0===s){var a=(0,r.default)(t);return null===a?void 0:e(a,n,o)}if("value"in s)return s.value;var u=s.get;return void 0!==u?u.call(o):void 0}},function(e,t,n){"use strict";e.exports={pushConfig:{1:"enable",2:"needBadge",3:"needPushNick",4:"pushContent",5:"custom",6:"pushPayload",7:"sound",10:"webrtcEnable"},liveOption:{1:"liveEnable",2:"webrtcEnable"},turnInfoTag:{0:"channelId",1:"tunnelServer",2:"proxyServer",3:"stunServer",4:"type",5:"dispatchServer"}}},function(e,t,n){"use strict";e.exports={pushConfig:{enable:1,needBadge:2,needPushNick:3,pushContent:4,custom:5,pushPayload:6,sound:7,webrtcEnable:10},liveOption:{liveEnable:1,webrtcEnable:2},turnInfoTag:{channelId:0,tunnelServer:1,proxyServer:2,stunServer:3,type:4,dispatchServer:5}}},function(e,t,n){"use strict";var r={wb:{id:11,initWhiteBoard:1,wbKeepCalling:2,wbCalleeAck:4,wbNotifyCalleeAck:5,wbHangup:8,wbNotifyHangup:9,wbControl:10,wbNotifyControl:11,wbNotifyRecord:12,wbCreateChannel:13,wbJoinChannel:14,wbNotifyJoin:15,wbQueryAccountUidMap:16}},i={initWhiteBoard:{sid:11,cid:r.wb.initWhiteBoard,params:[{type:"StrArray",name:"type"},{type:"StrArray",name:"accounts"},{type:"String",name:"pushContent"},{type:"String",name:"custom"},{type:"Property",name:"pushConfig"}]},wbKeepCalling:{sid:11,cid:r.wb.wbKeepCalling,params:[{type:"StrArray",name:"accounts"},{type:"long",name:"channelId"}]},wbCalleeAck:{sid:11,cid:r.wb.wbCalleeAck,params:[{type:"long",name:"channelId"},{type:"bool",name:"accepted"}]},wbHangup:{sid:11,cid:r.wb.wbHangup,params:[{type:"long",name:"channelId"}]},wbControl:{sid:11,cid:r.wb.wbControl,params:[{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"string",name:"info"}]},wbCreateChannel:{sid:11,cid:r.wb.wbCreateChannel,params:[{type:"String",name:"channelName"},{type:"String",name:"custom"},{type:"String",name:"webrtcEnable"}]},wbJoinChannel:{sid:11,cid:r.wb.wbJoinChannel,params:[{type:"String",name:"channelName"},{type:"Property",name:"liveOption"}]},wbQueryAccountUidMap:{sid:11,cid:r.wb.wbQueryAccountUidMap,params:[{type:"String",name:"channelName"},{type:"LongArray",name:"uids"}]}},o={"11_1":{service:"datatun",cmd:"initWhiteBoard",response:[{type:"Number",name:"timetag"},{type:"Number",name:"uid"},{type:"Number",name:"channelId"},{type:"PropertyArray",name:"turnInfoTag"},{type:"StrArray",name:"keepCallingAccounts"},{type:"StrLongMap",name:"accountUidMap"},{type:"bool",name:"p2p"},{type:"String",name:"clientConfig"}]},"11_2":{service:"datatun",cmd:"wbKeepCalling",response:[{type:"StrArr",name:"accounts"}]},"11_3":{service:"datatun",cmd:"wbBeCalled",response:[{type:"Number",name:"timetag"},{type:"String",name:"account"},{type:"Number",name:"channelId"},{type:"PropertyArray",name:"turnInfoTag"},{type:"StrLongMap",name:"accountUidMap"},{type:"bool",name:"p2p"},{type:"String",name:"custom"},{type:"Number",name:"uid"},{type:"String",name:"clientConfig"},{type:"Property",name:"pushConfig"}]},"11_4":{service:"datatun",cmd:"wbCalleeAck",response:[]},"11_5":{service:"datatun",cmd:"wbNotifyCalleeAck",response:[{type:"long",name:"channelId"},{type:"String",name:"account"},{type:"bool",name:"accepted"}]},"11_6":{service:"datatun",cmd:"wbNotifyCalleeAckSync",response:[{type:"String",name:"timetag"},{type:"long",name:"channelId"},{type:"byte",name:"type"},{type:"bool",name:"accepted"},{type:"byte",name:"fromClientType"}]},"11_7":{service:"datatun",cmd:"xxxx",response:[]},"11_8":{service:"datatun",cmd:"wbHangup",response:[]},"11_9":{service:"datatun",cmd:"wbNotifyHangup",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"String",name:"account"}]},"11_10":{service:"datatun",cmd:"wbControl",response:[]},"11_11":{service:"datatun",cmd:"wbNotifyControl",response:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"string",name:"info"},{type:"long",name:"channelId"}]},"11_12":{service:"datatun",cmd:"wbNotifyRecord",response:[{type:"Property",name:"msg"}]},"11_13":{service:"datatun",cmd:"wbCreateChannel",response:[{type:"long",name:"timetag"}]},"11_14":{service:"datatun",cmd:"wbJoinChannel",response:[{type:"long",name:"timetag"},{type:"long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"},{type:"Property",name:"turnInfoTag"},{type:"String",name:"custom"}]},"11_15":{service:"datatun",cmd:"wbNotifyJoin",response:[{type:"Long",name:"channelId"},{type:"StrLongMap",name:"accountUidMap"}]},"11_16":{service:"datatun",cmd:"wbQueryAccountUidMap",response:[]}};e.exports={idMap:r,cmdConfig:i,packetConfig:o}},function(e,t,n){"use strict";var r={install:function(e){var t=e.Protocol.fn;t.processDatatun=function(e){switch(e.cmd){case"initWhiteBoard":this.onWbInit(e);break;case"wbBeCalled":this.onWbBeCalled(e);break;case"wbKeepCalling":this.onWbKeepCalling(e);break;case"wbCalleeAck":break;case"wbNotifyCalleeAck":this.onWbNotifyCalleeAck(e);break;case"wbHangup":break;case"wbNotifyHangup":this.onWbNotifyHangup(e);break;case"wbNotifyControl":this.onWbControl(e);break;case"wbNotifyCalleeAckSync":this.onWbNotifyCalleeAckSync(e);break;case"wbNotifyRecord":case"wbCreateChannel":break;case"wbJoinChannel":this.wbJoinChannel(e);break;case"wbNotifyJoin":this.onWbNotifyJoin(e)}},t.onWbInit=function(e){if(!e.error){var t=e.obj.type;e.obj=e.content,e.obj.type=t,e.obj.accounts=e.obj.keepCallingAccounts,this.setCurrentWhiteBoard(e.obj.channelId),this.emitAPI({type:"wbInited",obj:e.content}),this.wbKeepCalling(e)}},t.setCurrentWhiteBoard=function(e){this.currentWhiteBoardChannelId=e},t.onWbKeepCalling=function(e){e.error||e.content.accounts.length&&this.wbKeepCalling(e)},t.wbKeepCalling=function(e){var t=this,n=e.obj,r=n.type,i=n.accounts,o=n.channelId;i&&i.length&&setTimeout(function(){t.currentWhiteBoardChannelId&&t.currentWhiteBoardChannelId===o&&t.api.wbKeepCalling({type:r,accounts:i,channelId:o}).catch(function(){})},3e3)},t.onWbBeCalled=function(e){e.error||this.emitAPI({type:"wbBeCalled",obj:e.content})},t.onWbNotifyCalleeAck=function(e){e.error||this.emitAPI({type:"wbNotifyCalleeAck",obj:e.content})},t.onWbNotifyHangup=function(e){e.error||this.emitAPI({type:"wbNotifyHangup",obj:e.content})},t.onWbControl=function(e){e.error||this.emitAPI({type:"wbControl",obj:e.content})},t.onWbNotifyCalleeAckSync=function(e){e.error||this.emitAPI({type:"wbNotifyCalleeAckSync",obj:e.content})},t.onWbNotifyJoin=function(e){e.error||this.emitAPI({type:"wbNotifyJoin",obj:e.content})},t.wbJoinChannel=function(e){e.obj=e.content}}};e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.util;return r=t.notundef,i};var r=void 0;function i(e){r(e.enable)&&(this.enable=e.enable?1:0),r(e.needBadge)&&(this.needBadge=e.needBadge?1:0),r(e.needPushNick)&&(this.needPushNick=e.needPushNick?1:0),r(e.pushContent)&&(this.pushContent=""+e.pushContent),r(e.custom)&&(this.custom=""+e.custom),r(e.pushPayload)&&(this.pushPayload=""+e.pushPayload),r(e.sound)&&(this.sound=""+e.sound),r(e.webrtcEnable)&&(this.webrtcEnable=e.webrtcEnable?1:0),r(e.forceKeepCalling)&&(this.forceKeepCalling=e.forceKeepCalling?1:0)}e.exports=t.default},function(e,t,n){"use strict";var r=n(348),i={install:function(e){var t=e.fn,n=e.util,i=r({util:n});t.initWhiteBoard=function(e){return n.verifyOptions(e,"type accounts","wb::initWhiteBoard"),e.pushContent="",e.custom="",e.pushConfig||(e.pushConfig={}),e.pushConfig.webrtcEnable=e.webrtcEnable,e.pushConfig=new i(e.pushConfig),this.cbAndSendCmd("initWhiteBoard",e)},t.wbKeepCalling=function(e){return n.verifyOptions(e,"type accounts channelId","wb::wbKeepCalling"),this.cbAndSendCmd("wbKeepCalling",e)},t.wbCalleeAck=function(e){return n.verifyOptions(e,"account channelId type accepted","wb::wbCalleeAck"),this.cbAndSendCmd("wbCalleeAck",e)},t.wbHangup=function(e){return n.verifyOptions(e,"channelId","wb::wbHangup"),this.cbAndSendCmd("wbHangup",e)},t.wbControl=function(e){return n.verifyOptions(e,"channelId type","wb::wbControl"),e.info=e.info||"",this.cbAndSendCmd("wbControl",e)},t.wbCreateChannel=function(e){return this.cbAndSendCmd("wbCreateChannel",e)},t.wbJoinChannel=function(e){return n.verifyOptions(e,"channelName","wb::wbJoinChannel"),n.verifyBooleanWithDefault(e,"liveEnable",!1,"","wb::wbJoinChannel"),n.verifyBooleanWithDefault(e,"webrtcEnable",!1,"","wb::wbJoinChannel"),this.cbAndSendCmd("wbJoinChannel",{channelName:e.channelName,liveOption:{liveEnable:e.liveEnable?1:0,webrtcEnable:e.webrtcEnable?1:0}})},t.wbQueryAccountUidMap=function(e,t){return this.cbAndSendCmd("wbQueryAccountUidMap",{channelName:e,uids:t})}}};e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var r=f(n(40)),i=f(n(39)),o=f(n(169)),s=f(n(168)),a=n(224),u=n(167),c=n(341),l=f(n(223));function f(e){return e&&e.__esModule?e:{default:e}}var d=n(22),h=n(0),p=h.getGlobal(),m=(u.WHITEBOARD_CONFIG.channelTimeout,u.WHITEBOARD_CONFIG.signalTimeout),v=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._init(e),n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destroy",value:function(){var e=this;return this.logger.info("wb::ws: call destroy session"),new Promise(function(t,n){e.logger.info("wb::ws: destroy session"),e.stopHeartBeat(),e.logout();var r=void 0;e._wss&&e._wss.readyState!==p.WebSocket.CLOSED?(e._wss.onclose=function(){e.logger.debug("wb::ws: destroy onclosed"),e.emit("signalTimeout"),e.emit("signalClosed"),t(),clearTimeout(r)},e._wss.onerror=function(n){e.logger.debug("wb::ws: destroy onerror ",n),t(n),clearTimeout(r)},e.logger.debug("wb::ws: destroy close websocket"),e._wss.close(),clearTimeout(e._status.closingTimer),r=e._status.closingTimer=setTimeout(function(){e.emit("signalTimeout"),e.emit("signalClosed"),t(Error("wb::ws: destroy notify close because of timeout"))},9e4)):t()}).then(function(){return e._reset(),e.logger.info("wb::ws: destroy ws onclosed"),Promise.resolve()})}},{key:"_reset",value:function(){this._status&&clearTimeout(this._status.closingTimer),this._status={isDestroy:!0,reConnectCount:0,connected:!1,isHeartBeating:null,heartBeatLast:null,imInfo:{},send_bytes:0,recv_bytes:0,closingTimer:null},this._config={autoReconnect:!0},this._wssUrl=null,this._wss=null,this.eventReset()}},{key:"_init",value:function(e){var t=e.autoReconnect,n=void 0===t||t,r=e.logger,i=void 0===r?l.default.pureLogFunc:r;this.logger=i,this._reset(),this._status.isDestroy=!1,h.merge(this._config,{autoReconnect:n,info:h.simpleClone(e)})}},{key:"setImInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.merge(this._status.imInfo,e)}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.url,r=void 0===n?this._wssUrl:n,i=t.imInfo,o=void 0===i?this._status.imInfo:i;return this.setImInfo(o),r?new Promise(function(t,n){try{e.logger.info("wb::ws: start session "+r),e._wss=new p.WebSocket("wss://"+r),e._wss.onopen=function(n){e._wssUrl=r,e.initSignal(),e._status.connected=!0,e.logger.debug("wb::ws: websocket onopen"),e.emit("signalConnected"),t(e)},e._wss.onclose=e._wss.onerror=function(t){e.logger.info("wb::ws: ws 原生错误/关闭"),e._status.connected=!1,n(t)}}catch(t){e.logger.error("wb::ws: 信令连接建立失败",t),n(t)}}):Promise.reject(Error("信令地址缺失"))}},{key:"initSignal",value:function(){var e=this;this._wss.onmessage=function(t){var n=JSON.parse(t.data||null);n&&("loginAck"!==n.type&&n.type!==c.serializeWb.gateWay.loginAck||e.startHeartbeat(),!e._status.isHeartBeating||"keep_alive_ack"!==n.type&&n.type!==c.serializeWb.gateWay.keep_alive_ack?e.emit("signalMessage",n):e.onHeartBeat(n))},this._wss.onclose=function(t){e.logger.info("wb::ws: ws 原生关闭"),e._status.connected=!1,e.emit("signalTimeout",t)},this._wss.onerror=function(t){e.logger.info("wb::ws: ws 原生错误"),e._status.connected=!1,e.emit("signalTimeout",t)}}},{key:"send",value:function(e){e.type,this._wss&&this._status.connected&&this._wss.readyState===this._wss.OPEN&&(e.browser={},e.browser.name=d.name,e.browser.version=d.version,this._wss.send(JSON.stringify(e)))}},{key:"startHeartbeat",value:function(){var e=this;this.logger.info("wb::ws: startHeartbeat at"+(new Date).toLocaleString()),this._status.heartBeatLast=Date.now(),this._status.isHeartBeating&&clearInterval(this._status.isHeartBeating),this._status.isHeartBeating=setInterval(function(){e.heartBeatHandler()},3600)}},{key:"onHeartBeat",value:function(e){console.warn("on heart beat ",(new Date).toLocaleString());var t=Date.now();this._status.heartBeatLast=t}},{key:"heartBeatHandler",value:function(){var e=Date.now();if(!this._status.heartBeatLast||"number"!=typeof this._status.heartBeatLast)return this.sendMsg("keep_alive"),void(this._status.heartBeatLast=e);var t=Date.now()-this._status.heartBeatLast;t>1e3*m?(this.logger.error("wb::ws: socket error: heartbeat timeout"),this.destroy()):t>1e3&&t<=1e3*m&&(t>1e4&&this.logger.warn("wb::ws: socket error: no response, keep heartbeat",this._status.heartBeatLast),this.sendMsg("keep_alive"))}},{key:"stopHeartBeat",value:function(){this.logger.info("wb::ws: stopHeartBeat at"+(new Date).toLocaleString()),this._status.isHeartBeating&&(this._status.isHeartBeating&&clearInterval(this._status.isHeartBeating),this._status.isHeartBeating=null,this._status.heartBeatLast=null)}},{key:"login",value:function(){var e=this._status.imInfo,t={token:e.cid,client_type:2,client_net:2,client_os:6,client_support_record:~~e.sessionConfig.record};this.logger.debug("wb::ws: login",t),this.sendMsg("login",t)}},{key:"logout",value:function(){this.logger.debug("wb::ws: logout"),this.sendMsg("logout",{recv_bytes:this._status.recv_bytes,send_bytes:this._status.send_bytes})}},{key:"sendMsg",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._status.imInfo,o={type:e=c.serializeWb.gateWay[e],uid:+i.uid,cid:+i.cid,version:31,content:{params:n}},s=Date.now();t=+s.toString().slice(0,-3),r&&(o.content.params.timestamp=t),this.send(o)}},{key:"sendStats",value:function(e){this._status.send_bytes+=e.length}},{key:"receiveStats",value:function(e){this._status.recv_bytes+=e.length}}]),t}(a.EventEmitter);t.Signal=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WbController=void 0;var r=f(n(40)),i=f(n(39)),o=f(n(169)),s=f(n(168)),a=n(224),u=n(350),c=n(167),l=n(341);function f(e){return e&&e.__esModule?e:{default:e}}var d=n(0),h=c.WHITEBOARD_CONFIG.channelTimeout,p=Number.POSITIVE_INFINITY,m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._init(e),n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destroy",value:function(){var e=this;return this.stopSession().then(function(){return e._reset(),e.eventReset(),Promise.resolve()})}},{key:"reset",value:function(){this._resetStatus()}},{key:"_reset",value:function(){this._resetStatus(),this._config={appKey:""},this.adapterRef={status:{}},this._signal=null}},{key:"_resetStatus",value:function(){this.__status&&(clearTimeout(this.__status.nodeTimer),clearTimeout(this.__status.reConnectTimer)),this.__status={wssUrl:null,nodeTimer:null,reConnectTimer:null,reConnectCount:0,userJoinTimer:null,remoteNodeStatus:{}}}},{key:"_init",value:function(e){this._reset();var t=e.adapterRef,n=e.nim,r=e.wbReconnectLimit;d.merge(this.adapterRef,t);var i=!1,o=parseInt(r);"number"==typeof o&&o==o&&(i=!0),this.logger=this.adapterRef.logger,i?this.logger.log("valid reconnect limit",o):this.logger.log("invalid reconnect limit, will reconnect infinity"),this.reconnectLimit=i?o:p,this._config.appKey=n&&n.options.appKey,this._initEvent()}},{key:"_initEvent",value:function(){}},{key:"isSignalConnected",value:function(){return this._signal&&this._signal._status.connected}},{key:"startSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.adapterRef.status;(t=d.merge(n.imInfo,t)).uid=+t.uid,t.cid=+t.cid,this.adapterRef.setSessionConfig(t.sessionConfig);var r=t.serverMap||{};return t.urlArray=t.serverAddrs&&d.simpleClone(t.serverAddrs)||r.webrtcarray&&JSON.parse(JSON.stringify(r.webrtcarray))||[r.webrtc],Promise.resolve().then(function(){return e._signal?(e._signal.setImInfo(t),Promise.resolve(e._signal)):e._initSignal()}).then(function(t){return e.__status.wssUrl=t,e.__status.reConnectCount=0,new Promise(function(t,n){e._signal.login(),e.once("LoginSuccess",function(n){e.logger.debug("wb::wbCtrl: once LoginSuccess--\x3e",n),t(e.__status.wssUrl)}),e.once("LoginFailed",function(t){e.logger.debug("wb::wbCtrl: once LoginFailed--\x3e",t),e._signal.destroy().then(function(){return e.emit("signalClosed"),Promise.resolve()}).finally(function(){n(t)})})})}).catch(function(e){return n.signalInited=!1,n.sessionStarted=!1,Promise.reject(e)})}},{key:"stopSession",value:function(){var e=this;return this.logger.info("wb::wbCtrl: start stop session ..."),this._signal&&this._signal.logout(),this._stopSignal().then(function(){return e._resetStatus(),Promise.resolve()})}},{key:"_initSignal",value:function(){var e=this;if(this._signal)return Promise.resolve();var t=new u.Signal({logger:this.logger}),n=this.adapterRef.status,r=n.imInfo.urlArray,i=null,o=this.adapterRef.config;if(!r)return Promise.reject(Error("wb::wbCtrl: 无网关服务器地址列表"));if(!(i=r.shift()))return Promise.reject(Error("wb::wbCtrl: 无可用的网关服务器地址"));if(o.sessionWsFullUrl)i=o.sessionWsFullUrl,this.logger.log("wb::wbCtrl:initSignal use customized websocket full url "+i);else if(o.sessionWsUrl){var s=i.indexOf("?"),a=s>0?i.substr(s):"";i=o.sessionWsUrl+a,this.logger.log("wb::wbCtrl:initSignal use customized websocket host "+i)}return t.connect({url:i,imInfo:n.imInfo}).then(function(t){return e.logger.log("wb::wbCtrl:initSignal signal connected"),e._signal=t,e._initSignalEvent(),t.emit("connected"),Promise.resolve(t.url)}).catch(function(t){return e._initSignal()})}},{key:"_initSignalEvent",value:function(){var e=this,t=this._signal;t.on("signalConnected",function(){e.logger.log("wb::wbCtrl:signalConnected")}),t.on("signalTimeout",function(){e.logger.log("wb::wbCtrl:signalTimeout"),e.onSignalTimeout()}),t.on("signalMessage",function(t){e.onSignalMessage(t)}),t.on("signalClosed",function(){e.logger.log("wb::wbCtrl:signalClosed"),e._resetStatus(),e.emit("signalClosed")})}},{key:"_stopSignal",value:function(){var e=this;this.logger.log("wb::wbCtrl:_stop signal"),clearTimeout(this.__status.reConnectTimer);var t=this._signal;return t?t.destroy().then(function(){return e._signal=null,Promise.resolve()}):Promise.resolve()}},{key:"_startNodeMonitor",value:function(e){var t=this,n=this.__status.remoteNodeStatus;n[e]=n[e]||{now:Date.now(),total:h},n[e].now=Date.now(),this.__status.nodeTimer||(this.__status.nodeTimer=setInterval(function(){var r=Date.now();Object.keys(n).forEach(function(i){if(n[i]){if(r-n[i].now>1e3*h||n[i].total<=0){t.logger.warn("wb::wbCtrl: 节点"+h+"s超时离开:",i);var o=t.adapterRef.status;return t.emit("userLeft",{uid:i,type:c.WHITEBOARD_CONSTS.HANGUP_TYPE_TIMEOUT,channelId:o.imInfo.cid}),delete t.__status.remoteNodeStatus[e],void delete n[i]}r-n[i].now>3e3&&(n[i].total-=3)}})},3e3))}},{key:"onSignalTimeout",value:function(){var e=this;if(this.__status.reConnectCount>=this.reconnectLimit)return this.logger.debug("wb::wbCtrl: signal finally closed of exceed retry times"),this.emit("disconnected"),void this.emit("signalClosed");this._stopSignal().then(function(){e.__status.reConnectCount++,e.logger.debug("wb::wbCtrl: 5s后尝试第"+e.__status.reConnectCount+"次重连服务器"),e.emit("willReconnect",e.__status.reConnectCount),clearTimeout(e.__status.reConnectTimer),e.__status.reConnectTimer=setTimeout(function(){var t=e.adapterRef.status;t.imInfo&&t.imInfo.serverAddrs?(e.logger.debug("wb::wbCtrl: start No."+e.__status.reConnectCount+" retry connecting "+e.__status.wssUrl),e.__status.wssUrl&&t.imInfo.serverAddrs.unshift(e.__status.wssUrl),e.startSession().then(function(){e.emit("connected",e.__status.reConnectCount)}).catch(function(t){e.logger.error("wb::wbCtrl: reconnect error",t),!0!==t.notReedReconnect?e.onSignalTimeout():e.emit("signalClosed")})):e.logger.debug("wb::wbCtrl: no im info, cannot retry...")},5e3)})}},{key:"onSignalMessage",value:function(e){var t=this.adapterRef.status;e&&e.cid&&e.uid&&(e.cid=+e.cid,e.uid=+e.uid);var n=l.unserializeWb.gateWay[e.type];"logout"===n||e.cid===t.imInfo.cid?("logout"===n&&(this.logger.debug("wb::wbCtrl: emit logout event by message ",e),this.emit("onceLogout")),this["on"+n]&&this["on"+n](e)):this.logger.error("wb::wbCtrl: ws msg not belong to this session")}},{key:"onkeep_alive_node",value:function(e){var t=e.uid,n=this.__status.remoteNodeStatus;n[t]=n[t]||{now:Date.now(),total:h},n[t].now=Date.now(),n[t].total=h}},{key:"onloginAck",value:function(e){var t=this,n=e.content.params.auth_result-0;if(200!==n)return this.logger.error("wb::wbCtrl: 服务器验证不通过, 断开连接"),void this.emit("LoginFailed",{code:n,error:"服务器验证不通过, 断开连接",notReedReconnect:!0});this.logger.info("wb::wbCtrl: 白板服务器登录成功",e);var r={};try{var i=e.content&&e.content.params;if(i)r={recordFileName:i.record_file_name,recordAddr:i.record_addr}}catch(e){console.error(e)}this.emit("LoginSuccess",r),"p2p"===this.adapterRef.status.imInfo.sessionMode&&(this.logger.debug("wb::wbCtrl: 180s waiting for p2p user join..."),clearTimeout(this.__status.userJoinTimer),this.__status.userJoinTimer=setTimeout(function(){t.__status.userJoinTimer&&0===Object.keys(t.__status.remoteNodeStatus).length&&(t.emit("onceLogout"),t.emit("error",{error:"点对点对方登录超时, 断开连接"}))},18e4))}},{key:"onjoin",value:function(e){this.logger.info("wb::wbCtrl: onjoin",e);var t=e.content&&e.content.params&&e.content.params.client_id,n=this.adapterRef.status;this._startNodeMonitor(t),"p2p"===n.imInfo.sessionMode&&(n.target={uid:t},this.__status.userJoinTimer&&clearTimeout(this.__status.userJoinTimer),this.__status.userJoinTimer=null),this.emit("userJoined",{uid:t,cid:e.cid})}},{key:"onlogout",value:function(e){this.logger.info("wb::wbCtrl: onlogout",e),this.emit("userLeft",{uid:e.uid,channelId:e.cid}),delete this.__status.remoteNodeStatus[e.uid]}},{key:"ontoUser",value:function(e){this.onData(e)}},{key:"onbroadcast",value:function(e){this.onData(e)}},{key:"onData",value:function(e){var t=e.content&&e.content.params&&e.content.params.data,n=e.uid;this._signal.receiveStats(t);try{t=JSON.parse(t||null)}catch(e){}this.onkeep_alive_node({uid:n}),this.emit("data",{uid:n,data:t})}},{key:"sendData",value:function(e){var t=e.data,n=e.toAccount,r=void 0===n?0:n;if(t)if(this._signal){this._signal.sendStats(t);var i={data:t};"0"===r&&(r=+r);var o=this.adapterRef.status;"p2p"===o.imInfo.sessionMode?i.dst_client_id=o.target&&o.target.uid||0:r&&(i.dst_client_id=this.adapterRef.getUidWithAccount(r));var s=i.dst_client_id?"toUser":"broadcast";this._signal.sendMsg(s,i)}else this.emit("error",{message:"websocket session is not exists ...",callFunc:"wb::wbCtrl:sendData"})}}]),t}(a.EventEmitter);t.WbController=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImController=void 0;var r=c(n(40)),i=c(n(39)),o=c(n(169)),s=c(n(168)),a=n(224),u=c(n(223));function c(e){return e&&e.__esModule?e:{default:e}}var l=n(0),f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._init(e),n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destroy",value:function(){return this._reset(),this.eventReset(),Promise.resolve()}},{key:"reset",value:function(){this._resetStatus()}},{key:"_reset",value:function(){this._resetStatus(),this._config={},this._nim=null,this.adapterRef||(this.adapterRef={})}},{key:"_resetStatus",value:function(){if(this._nim){var e=this._nim;e.protocol&&e.protocol.setCurrentWhiteBoard&&e.protocol.setCurrentWhiteBoard()}this.__status&&(clearTimeout(this.__status.timeoutTimer),this.__status.timeoutTimer=null)}},{key:"_init",value:function(e){this._reset();var t=e.adapterRef,n=e.nim;this._nim=n,l.merge(this.adapterRef,t),this.logger=this.adapterRef.logger,this._initEvent()}},{key:"_initEvent",value:function(){this._nim.on("wbInited",this._onInited.bind(this)),this._nim.on("wbBeCalled",this._onBeCalled.bind(this)),this._nim.on("wbNotifyCalleeAck",this._onCalleeAck.bind(this)),this._nim.on("wbNotifyHangup",this._onHangup.bind(this)),this._nim.on("wbControl",this._onControl.bind(this)),this._nim.on("wbNotifyCalleeAckSync",this._onCalleeAckSync.bind(this)),this._nim.on("wbNotifyJoin",this._onNotifyJoin.bind(this))}},{key:"initWhiteBoard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._nim)return this._nim.initWhiteBoard(e);return Promise.reject({message:"nim not exists",callFunc:"wb::imCtrl: initWhiteBoard"})}},{key:"_onInited",value:function(e){this.emit("inited",e)}},{key:"_onBeCalled",value:function(e){e=u.default.format(e);var t=this.adapterRef.status;t.channelId?t.signalInited&&this.logger.info("wb::imCtrl: beCalling when already in session",e):(t.channelId=e.channelId,t.beCalledInfo=e,this.logger.info("wb::imCtrl: beCalling and set info",e)),this.emit("beCalling",e)}},{key:"_onNotifyJoin",value:function(e){var t=this.adapterRef.status;this.logger.info("wb::main: onNotifyJoin from IM");var n=e.accountUidMap,r=t.needQueryAccountMap;for(var i in this.adapterRef.parseAccountUidMap(n),n){var o=i,s=n[i];if(s in r){var a=r[s];a.account=o,delete r[s],this.logger.info("wb::main: onNotifyJoin from IM",e),this.emit("userJoined",a)}}}},{key:"_onCalleeAck",value:function(e){if(this.logger.info("wb::imCtrl: onCalleeAck",e),!this.notCurrentChannelId(e)){var t=e.account,n=this.adapterRef.status,r=n.beCalledInfo||n.callerInfo;n.target.account=t,this.adapterRef.setSessionConfig({signalEndTime:Date.now()}),e.accepted?(n.callAccepted=!0,this.emit("onCalleeAckAccept")):(this.logger.info("wb::imCtrl: call Rejected",e),this.packNetcallRecord({type:e.type,channelId:e.channelId,isCaller:!0,target:e.account,recordType:"netcallRejected"}),this.emit("onCalleeAckReject",{type:r.type,account:t}))}}},{key:"_onHangup",value:function(e){var t=this.adapterRef.status;t.channelId&&("p2p"!==t.sessionMode&&null!==t.sessionMode||(this.logger.info("wb::imCtrl: on hangup from IM"),this.emit("onHangup",{channelId:e.channelId||t.channelId,account:e.account,type:0})))}},{key:"_onControl",value:function(e){this.emit("control",e)}},{key:"_onCalleeAckSync",value:function(e){var t=this;this.isCurrentChannelId(e)?this._resetWhenHangup().then(function(){t.emit("callerAckSync",e)}):this.emit("callerAckSync",e)}},{key:"packNetcallRecord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.adapterRef.status,n=e.recordType,r=e.type||t.type,i=e.channelId||t.channelId,o=e.duration||0,s=e.isCaller||t.isCaller,a=e.target||t.target.account,c=this.nimGetAccount(),l=s?c:a,f=s?a:c,d=+new Date;this._nim.protocol.onMsg({content:{msg:{attach:JSON.stringify({data:{calltype:r,channel:i,duration:o,ids:[c,a],time:d},id:n}),from:l,fromClientType:s?16:0,fromDeviceId:"",fromNick:"",idClient:u.default.guid(),idServer:u.default.guid(),scene:0,time:d,to:f,type:5}}})}},{key:"nimFn",value:function(e,t){return this._nim[e](t)}},{key:"nimGetAccount",value:function(){return this._nim&&this._nim.account}},{key:"isCurrentChannelId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.adapterRef.status;return t.channelId&&t.channelId===e.channelId}},{key:"notCurrentChannelId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.isCurrentChannelId(e)}}]),t}(a.EventEmitter);t.ImController=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.wbControl={CONTROL_COMMAND_BUSY:9,CONTROL_COMMAND_SELF_ON_BACKGROUND:12,CONTROL_COMMAND_START_NOTIFY_RECEIVED:13}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.wbMap={WB_TYPE_TCP:2,WB_TYPE_UDP:3,CALL_TYPE_NONE:0,CALL_TYPE_AUDIO:1,HANGUP_TYPE_NORMAL:0,HANGUP_TYPE_TIMEOUT:-1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteBoardBase=void 0;var r=l(n(40)),i=l(n(39)),o=l(n(169)),s=l(n(168)),a=n(167),u=n(224),c=l(n(223));function l(e){return e&&e.__esModule?e:{default:e}}var f=n(22),d=n(0),h=d.getGlobal(),p=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.default)(this,t);var n=(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.__init(e),n}return(0,s.default)(t,e),(0,i.default)(t,[{key:"destroy",value:function(){return this.__reset(),this.eventReset(),Promise.resolve()}},{key:"reset",value:function(){this.__resetStatus()}},{key:"__init",value:function(e){this.__reset();var t=e.logger,n=e.debug,r=e.container,i=e.remoteContainer,o=e.sessionWsUrl,s=e.sessionWsFullUrl;this.logger=n&&(t||h.console)||c.default.pureLogFunc,d.merge(this.adapterRef,{imCtrl:null,wbCtrl:null,logger:this.logger,container:c.default.n2node(r),remoteContainer:c.default.n2node(i)}),"string"==typeof s&&/^[^.]+\.[^.]+/.test(s)&&(this._config.sessionWsFullUrl=s),"string"==typeof o&&/^[^.]+\.[^.]+/.test(o)&&(this._config.sessionWsUrl=o),"undefined"!=typeof window&&(/safari/gi.test(f.name)?h.addEventListener("pagehide",this._beforeunload.bind(this)):h.addEventListener("beforeunload",this._beforeunload.bind(this)))}},{key:"__reset",value:function(){var e=this;this.adapterRef&&Object.keys(this.adapterRef).forEach(function(t){delete e.adapterRef[t]}),this._config={},this.adapterRef={setSessionConfig:this.__setSessionConfig.bind(this),getUidWithAccount:this.__getUidWithAccount.bind(this),parseAccountUidMap:this.__parseAccountUidMap.bind(this)},this.__resetStatus(),this.eventReset()}},{key:"__resetStatus",value:function(){clearTimeout(this._emitTimer),this._emitTimer=null,clearTimeout(this._sessionTimer),this._sessionTimer=null,this._status||(this._status={}),d.merge(this._status,{signalInited:!1,channelId:null,type:null,target:{account:null,uid:null},sessionConfig:{},sessionMode:null,sessionStarted:!1,imInfo:{},calling:!1,isCaller:!1,callee:null,callAccepted:!1,callerInfo:null,beCalledInfo:null,needQueryAccountMap:{},accountUidMap:{},uidAccountMap:{},isOnHangup:!1}),d.merge(this.adapterRef,{status:this._status,config:this._config})}},{key:"_beforeunload",value:function(){}},{key:"serializeType",value:function(e,t){return t&&t!==a.WHITEBOARD_CONSTS.CALL_TYPE_NONE?t===a.WHITEBOARD_CONSTS.CALL_TYPE_NONE?[e]:[t,e]:[e]}},{key:"unserializeType",value:function(e){var t={},n=-1;return e.map(function(e,r){e===a.WHITEBOARD_CONSTS.CALL_TYPE_AUDIO&&(t.netcallType=a.WHITEBOARD_CONSTS.CALL_TYPE_AUDIO,n=r)}),-1!==n&&e.splice(t.i,1),t.type=e[0],t}},{key:"__setSessionConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._status.sessionConfig||(this._status.sessionConfig={}),d.merge(this._status.sessionConfig,e)}},{key:"__setAppKey",value:function(e){e&&(this._config.appKey=e)}},{key:"__getAccount",value:function(){return this.adapterRef.imCtrl?this.adapterRef.imCtrl.nimGetAccount():null}},{key:"__getUid",value:function(){if(this._status.accountUidMap){var e=this.__getAccount();return this._status.accountUidMap[e]||"-1"}return"-1"}},{key:"__parseAccountUidMap",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.__addAccountUidMap({account:n,uid:e[n]})})}},{key:"__addAccountUidMap",value:function(e){var t=e.account,n=e.uid;this._status.uidAccountMap[n]=t,this._status.accountUidMap[t]=n}},{key:"__getAccountWithUid",value:function(e){if(this._status.uidAccountMap)return this._status.uidAccountMap[e]}},{key:"__getUidWithAccount",value:function(e){if(this._status.accountUidMap)return this._status.accountUidMap[e]}}]),t}(u.EventEmitter);t.WhiteBoardBase=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteBoardController=void 0;var r=p(n(31)),i=p(n(40)),o=p(n(39)),s=p(n(169)),a=p(n(343)),u=p(n(168)),c=n(355),l=n(352),f=n(351),d=n(167),h=p(n(223));function p(e){return e&&e.__esModule?e:{default:e}}var m=n(0);t.WhiteBoardController=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,t);var n=(0,s.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._init(e),n}return(0,u.default)(t,e),(0,o.default)(t,[{key:"_init",value:function(e){this.reset(),this.adapterRef.imCtrl=new l.ImController((0,r.default)({},e,{adapterRef:this.adapterRef})),this.adapterRef.wbCtrl=new f.WbController((0,r.default)({},e,{adapterRef:this.adapterRef})),this._initEvent()}},{key:"_initEvent",value:function(){var e=this,t=this.adapterRef,n=t.imCtrl,r=t.wbCtrl;n&&(n.on("onCalleeAckAccept",function(){e._initSession()}),n.on("onCalleeAckReject",function(t){e._resetWhenHangup().then(function(){e.emit("callRejected",t)})}),n.on("onHangup",function(t){e._resetWhenHangup().then(function(){e.emit("hangup",t)})}),n.on("inited",function(t){e.emit("inited",t)}),n.on("beCalling",function(t){e.emit("beCalling",t)}),n.on("control",function(t){e.emit("control",t)}),n.on("callerAckSync",function(t){e.emit("callerAckSync",t)})),r&&(r.on("userJoined",function(t){e._onUserJoin(t)}),r.on("userLeft",function(t){e._onUserLeft(t)}),r.on("signalClosed",function(t){e.emit("signalClosed",t)}),r.on("willReconnect",function(t){e.emit("willReconnect",t)}),r.on("connected",function(t){e.emit("connected",t)}),r.on("disconnected",function(t){e.emit("disconnected",t)}),r.on("error",function(t){e.emit("error",t)}),r.on("data",function(t){e.emit("data",{account:e.__getAccountWithUid(t.uid),data:t.data})}))}},{key:"reset",value:function(){var e=this.adapterRef,n=e.imCtrl,r=e.wbCtrl;n&&n.reset(),r&&r.reset(),(0,a.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"destroy",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.adapterRef,i=r.wbCtrl,o=r.imCtrl;return Promise.resolve().then(function(){return i?i.destroy():Promise.resolve()}).then(function(){return o?o.destroy():Promise.resolve()}).then(function(){return(0,a.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",e).call(e)}).then(function(){return n.done instanceof Function&&n.done(),Promise.resolve()})}},{key:"_initWhiteBoard",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.type,r=t.netcallType,i=t.pushConfig;this._status.type=n,this._status.netcallType=r||d.WHITEBOARD_CONSTS.CALL_TYPE_NONE,this.__setSessionConfig({signalStartTime:Date.now()});var o={type:this.serializeType(n,this._status.netcallType),accounts:[this._status.callee],pushConfig:i,webrtcEnable:!0};return this.adapterRef.imCtrl.initWhiteBoard(o).then(function(t){var n=h.default.format(t);m.merge(e._status,{signalInited:!0,sessionMode:"p2p",callerInfo:n,channelId:t.channelId,imInfo:m.merge(n,{role:0,sessionMode:"p2p"})}),e.logger.info("wb::main:initWhiteBoard:",e._status)}).catch(function(t){return e.logger.error("wb::main:initWhiteBoard:",t),e.__setSessionConfig({signalEndTime:Date.now()}),e._resetWhenHangup(),Promise.reject(t)})}},{key:"_initSession",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._status.sessionMode="p2p";var n=this._status.isCaller?this._status.callerInfo:t.beCalledInfo;this.__parseAccountUidMap(n.accountUidMap),!n.account&&n.uid&&(n.account=this.__getAccountWithUid(n.uid)),this._status.callAccepted=!0,this._status.signalInited=!0,this.__setSessionConfig({signalEndTime:Date.now()}),this._status.target.uid=this.__getUidWithAccount(this._status.target.account);var r={type:n.type,account:this._status.target&&this._status.target.account||n.account,channelId:n.channelId};n.netcallType&&(r.netcallType=n.netcallType),this._status.imInfo.target=this._status.target,clearTimeout(this._emitTimer),this._emitTimer=setTimeout(function(){e.emit("callAccepted",r)},0)}},{key:"_startSession",value:function(){var e=this._status,t=e.imInfo;t.cid=t.cid||t.channelId;var n=e.sessionMode=e.sessionMode||"p2p";t.sessionMode=n,t.sessionConfig=e.sessionConfig,t.serverMap&&t.serverMap.constructor===String&&(t.serverMap=JSON.parse(t.serverMap))}},{key:"_response",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fn||"calleeAck",r=t.beCalledInfo||this._status.beCalledInfo,i=r.accepted=!1!==t.accepted;return i?(m.merge(this._status,{channelId:r.channelId,sessionMode:"p2p",type:r.type,calling:!0,imInfo:m.merge(r,{sessionMode:this.sessionMode,role:0})}),this._status.target.account=r.account,this.__setSessionConfig({signalStartTime:Date.now()})):(this.logger.info("reject call",r),this.adapterRef.imCtrl.packNetcallRecord({type:r.type,channelId:r.channelId,isCaller:!1,target:r.account,recordType:"rejectNetcall"})),this.adapterRef.imCtrl.nimFn(n,r).then(function(){i&&(t.sessionConfig&&e.__setSessionConfig(t.sessionConfig),e._status.beCalledInfo=r,e._initSession({beCalledInfo:r}))},function(t){throw e.logger.error(t),t})}},{key:"_control",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.channelId=t.channelId||this._status.channelId,t.command&&t.channelId){var n=t.fn||"wbControl";return t.type=t.command,this.adapterRef.imCtrl.nimFn(n,t).catch(function(t){e.logger.error(t)})}}},{key:"_hangup",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.channelId,r=void 0===n?this._status.channelId:n,i=t.recordType,o=void 0===i?"cancelWhiteBoardBeforeAccept":i;if(t.recordType=o,r){var s=t.fn||"hangup";return this.adapterRef.imCtrl.nimFn(s,{channelId:r}).then(function(){if(r===e._status.channelId)return e._status.isCaller&&!e._status.callAccepted&&(e.logger.info("wb::main:_hangup ",o,{channelId:r}),e.adapterRef.imCtrl.packNetcallRecord({recordType:o})),new Promise(function(t){clearTimeout(e._emitTimer),e._emitTimer=setTimeout(function(){t()},1e3),e.adapterRef.wbCtrl.once("onceLogout",function(){clearTimeout(e._emitTimer),t()})}).then(function(){return e._resetWhenHangup()})})}return Promise.resolve()}},{key:"_createChannel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m.verifyOptions(n,"channelName"),n.custom=n.custom||"",this.__setSessionConfig({signalStartTime:Date.now()}),this.adapterRef.imCtrl.nimFn(e,n).then(function(e){return Promise.resolve(e)}).catch(function(e){return t.__setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})}},{key:"_joinChannel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.adapterRef.imCtrl.nimFn(e,n).then(function(e){t.__setSessionConfig({signalEndTime:Date.now()}),t._status.signalInited=!0,t._status.sessionMode=e.sessionMode="meeting",t.__parseAccountUidMap(e.accountUidMap);var n=t.__getAccount();return e.uid=t.__getUidWithAccount(n),Promise.resolve(e)}).catch(function(e){return t.__setSessionConfig({signalEndTime:Date.now()}),Promise.reject(e)})}},{key:"_resetWhenHangup",value:function(){var e=this,t=[];return this.adapterRef.wbCtrl&&t.push(Promise.resolve().then(function(){return e.adapterRef.wbCtrl.stopSession()})),Promise.all(t).then(function(){return e.__resetStatus(),Promise.resolve()})}},{key:"_onUserJoin",value:function(e){if(e.type=e.type||this._status.type,e.account=this.__getAccountWithUid(e.uid),e.mode=this._status.sessionMode,e.account!==this.__getAccount()){if(e.account)return this.logger.info("wb::main: onUserJoin from wbCtrl",e),void this.emit("joinChannel",e);if(this._status.needQueryAccountMap[e.uid]=e,this.adapterRef.imCtrl){var t=this.adapterRef.imCtrl._nim||{};(t.queryAccountUidMap||t.wbQueryAccountUidMap).call(t,this._status.channelName,[e.uid])}}}},{key:"_onUserLeft",value:function(e){var t=this,n=this._status.imInfo;n.channelId&&(this.logger.info("wb::main: onUserLeft from wbCtrl",e),"p2p"===n.sessionMode?this._resetWhenHangup().then(function(){t.emit("hangup",{channelId:e.channelId||e.cid,account:t._status.target.account,type:e.type||0})}):this.emit("leaveChannel",{channelId:e.channelId||e.cid,account:this.__getAccountWithUid(e.uid),type:e.type||0}))}}]),t}(c.WhiteBoardBase)},function(e,t,n){var r=n(14);r(r.S,"Object",{create:n(67)})},function(e,t,n){n(357);var r=n(4).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){e.exports={default:n(358),__esModule:!0}},function(e,t,n){var r=n(19),i=n(13),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(46)(Function.call,n(99).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},function(e,t,n){var r=n(14);r(r.S,"Object",{setPrototypeOf:n(360).set})},function(e,t,n){n(361),e.exports=n(4).Object.setPrototypeOf},function(e,t,n){e.exports={default:n(362),__esModule:!0}},function(e,t,n){var r=n(18),i=n(99).f;n(342)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){n(364);var r=n(4).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},function(e,t,n){e.exports={default:n(365),__esModule:!0}},function(e,t,n){var r=n(61),i=n(109);n(342)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){n(367),e.exports=n(4).Object.getPrototypeOf},function(e,t,n){e.exports={default:n(368),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteBoardClient=void 0;var r=c(n(40)),i=c(n(39)),o=c(n(169)),s=c(n(343)),a=c(n(168)),u=n(356);function c(e){return e&&e.__esModule?e:{default:e}}var l=n(0);t.WhiteBoardClient=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return(0,a.default)(t,e),(0,i.default)(t,[{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.default)(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this,e)}},{key:"call",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account,n=e.type,r=e.netcallType,i=e.pushConfig,o=e.sessionConfig;return l.merge(this._status,{calling:!0,isCaller:!0,callee:t}),this._status.target.account=t,o&&(o.signalStartTime=Date.now(),this.__setSessionConfig(o)),this._initWhiteBoard({type:n,netcallType:r,pushConfig:i})}},{key:"response",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="wbCalleeAck",this._response(e)}},{key:"control",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="wbControl",this._control(e)}},{key:"hangup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.fn="wbHangup",this._hangup(e)}},{key:"createChannel",value:function(e){return this._createChannel("wbCreateChannel",e)}},{key:"joinChannel",value:function(e){var t=this;if(this._status.signalInited)return Promise.reject(Error("wb::client: 已经加入房间"));if(!e.channelName)return Promise.reject(Error("wb::client: 缺少参数 channelName"));var n=e.sessionConfig;return n&&(l.merge(this,{sessionConfig:n}),this.__setSessionConfig(n),this.__setSessionConfig({signalStartTime:Date.now()})),this._joinChannel("wbJoinChannel",{channelName:e.channelName}).then(function(r){t.logger.debug("wb::client: joinChannel ",r);var i=void 0;r.turnInfoTag&&(i=r.turnInfoTag.dispatchServer&&JSON.parse(r.turnInfoTag.dispatchServer)||r.turnInfoTag.tunnelServer),i&&i.constructor===String&&(i=i.split(";")),i&&i.constructor===Object&&(i=i.webrtcarray),r.serverAddrs=i||[],t._status.type=r.type=r.type;var o=r.account=t.__getAccount();return r.sessionConfig=n,t._status.imInfo=r,t._status.imInfo.role=void 0===e.role?0:e.role,clearTimeout(t._sessionTimer),t._sessionTimer=setTimeout(function(){t._status.sessionStarted||t.startSession(e)},300),Promise.resolve({uid:r.uid,account:o,type:r.type,cid:r.channelId})}).catch(function(e){return Promise.reject(e)})}},{key:"getStatus",value:function(){return l.simpleClone(this._status)}},{key:"getAccount",value:function(){return this.__getAccount()}},{key:"getUid",value:function(){return this.__getUid()}},{key:"isCurrentChannelId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._status.channelId&&this._status.channelId===e.channelId}},{key:"notCurrentChannelId",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.isCurrentChannelId(e)}},{key:"startSession",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._status.sessionStarted?Promise.resolve():(this._status.sessionStarted=!0,e.wssArr?this._status.imInfo.serverAddrs=Array.isArray(e.wssArr)?e.wssArr:[e.wssArr]:e.serverAddrs&&(this._status.imInfo.serverAddrs=Array.isArray(e.serverAddrs)?e.serverAddrs:[e.serverAddrs]),e.uid&&(this._status.imInfo=e.uid),e.cid&&(this._status.imInfo=e.cid),this._startSession(),this.adapterRef.wbCtrl.startSession(this._status.imInfo))}},{key:"stopSession",value:function(){return this._resetWhenHangup()}},{key:"leaveChannel",value:function(){var e=this,t=l.simpleClone(this._status.imInfo||{});return this.stopSession().then(function(){return e.emit("leaveChannel",t),Promise.resolve()})}},{key:"sendData",value:function(e){var t=e.data,n=e.toAccount,r=void 0===n?0:n;this.adapterRef.wbCtrl.sendData({data:t,toAccount:r})}},{key:"isChannelConnected",value:function(){return this.adapterRef.wbCtrl.isSignalConnected()}}]),t}(u.WhiteBoardController)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(370);Object.defineProperty(t,"WhiteBoardClient",{enumerable:!0,get:function(){return r.WhiteBoardClient}})},function(e,t,n){"use strict";var r,i=n(31),o=(r=i)&&r.__esModule?r:{default:r},s=n(371),a=n(167);n(101);var u=n(349),c=n(347),l=n(346),f=n(345),d=n(344),h=n(0),p=n(1),m=h.getGlobal(),v=(0,o.default)({version:p.info.version},a.WHITEBOARD_CONSTS,{install:function(e,t){u.install(e,t),c.install(e,t),e.parser.mixin({configMap:l,serializeMap:f,unserializeMap:d})},getInstance:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e.nim)throw Error({message:"you should passing nim into getInstance function",callFunc:"entry::wb:getInstance"});var t=h.simpleClone(a.DEFAULT_WHITEBOARD_OPTION);return e=h.merge(t,e),new s.WhiteBoardClient(e)},destroy:function(e){e&&(e.destroy(),e=null)},checkCompatibility:function(){return m.WebSocket instanceof Function}});e.exports=v}]);